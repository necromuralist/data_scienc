<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Using colors to help users see if a value is within a distribution's confidence interval.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Plotting With Uncertainty (Part II) | Data Science With Python</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/posts/plotting-with-uncertainty-part-ii/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script><meta name="author" content="necromuralist">
<link rel="prev" href="../plotting-with-uncertainty-part-i/" title="Plotting With Uncertainty (Part I)" type="text/html">
<link rel="next" href="../plotting-with-uncertainty-part-iii/" title="Plotting With Uncertainty (Part III)" type="text/html">
<meta property="og:site_name" content="Data Science With Python">
<meta property="og:title" content="Plotting With Uncertainty (Part II)">
<meta property="og:url" content="https://necromuralist.github.io/data_science/posts/plotting-with-uncertainty-part-ii/">
<meta property="og:description" content="Using colors to help users see if a value is within a distribution's confidence interval.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-04-22T14:12:41-08:00">
<meta property="article:tag" content="python visualization coursera">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Data Science With Python</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="../../pages/portland-unemployment-2007-to-2017">Portland Unemployment Visualization</a>
            </li></ul>
</li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.org" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Plotting With Uncertainty (Part II)</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    necromuralist
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-04-22T14:12:41-08:00" itemprop="datePublished" title="2017-04-22 14:12">2017-04-22 14:12</time></a></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>
This is an implementation of the <i>harder</i> option for Assignment 3 of coursera's <a href="https://www.coursera.org/learn/python-plotting/home/welcome">Applied Plotting, Charting &amp; Data Representation in Python</a>.
</p>

<div id="outline-container-org73f90a8" class="outline-2">
<h2 id="org73f90a8">Description</h2>
<div class="outline-text-2" id="text-org73f90a8">
<p>
A challenge that users face is that, for a given y-axis value (e.g.
42,000), it is difficult to know which x-axis values are most likely to
be representative, because the confidence levels overlap and their
distributions are different (the lengths of the confidence interval bars
are unequal). One of the solutions the authors propose for this problem
(Figure 2c) is to allow users to indicate the y-axis value of interest
(e.g. 42,000) and then draw a horizontal line and color bars based on
this value. So bars might be colored red if they are definitely above
this value (given the confidence interval), blue if they are definitely
below this value, or white if they contain this value.
</p>

<p>
<b>Harder option:</b> Implement the bar coloring as described in the paper,
where the color of the bar is actually based on the amount of data
covered (e.g. a gradient ranging from dark blue for the distribution
being certainly below this y-axis, to white if the value is certainly
contained, to dark red if the value is certainly not contained as the
distribution is above the axis).
</p>
</div>
</div>

<div id="outline-container-orgc16eee1" class="outline-2">
<h2 id="orgc16eee1">Imports</h2>
<div class="outline-text-2" id="text-orgc16eee1">
<p>
All the imports were created by third-parties (taken from pypi).
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>

<div id="outline-container-org9b29668" class="outline-3">
<h3 id="org9b29668">Some Plotting Setup</h3>
<div class="outline-text-3" id="text-org9b29668">
/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgb3aa253" class="outline-2">
<h2 id="orgb3aa253">The Data</h2>
<div class="outline-text-2" id="text-orgb3aa253">
<p>
There data set will be four normally-distributed, randomly generated data sets each representing a simulated data set for a given year.
</p>
</div>

<div id="outline-container-org79f3e06" class="outline-3">
<h3 id="org79f3e06"><code>numpy.random.normal</code></h3>
<div class="outline-text-3" id="text-org79f3e06">
<p>
This is from the <code>numpy.random.normal</code> doc-string:
</p>

<p>
<code>normal(loc=0.0, scale=1.0, size=None)</code>
</p>

<p>
Draw random samples from a normal (Gaussian) distribution.
</p>

<p>
The probability density function of the normal distribution, first
derived by De Moivre and 200 years later by both Gauss and Laplace
independently [2]_, is often called the bell curve because of
its characteristic shape (see the example below).
</p>

<p>
The normal distributions occurs often in nature.  For example, it
describes the commonly occurring distribution of samples influenced
by a large number of tiny, random disturbances, each with its own
unique distribution.
</p>
</div>
</div>

<div id="outline-container-org1065cd0" class="outline-3">
<h3 id="org1065cd0">Parameters</h3>
<div class="outline-text-3" id="text-org1065cd0">
</div>
<div id="outline-container-orgd391363" class="outline-4">
<h4 id="orgd391363">
<code>loc</code> : float or array<sub>like</sub> of floats</h4>
<div class="outline-text-4" id="text-orgd391363">
<p>
Mean ("centre") of the distribution.
</p>
</div>
</div>
<div id="outline-container-org0c570a6" class="outline-4">
<h4 id="org0c570a6">
<code>scale</code> : float or array<sub>like</sub> of floats</h4>
<div class="outline-text-4" id="text-org0c570a6">
<p>
Standard deviation (spread or "width") of the distribution.
</p>
</div>
</div>
<div id="outline-container-org7cc934a" class="outline-4">
<h4 id="org7cc934a">
<code>size</code> : int or tuple of ints, optional</h4>
<div class="outline-text-4" id="text-org7cc934a">
<p>
Output shape.  If the given shape is, e.g., <code>(m, n, k)</code>, then
<code>m * n * k</code> samples are drawn.  If size is <code>None</code> (default),
a single value is returned if <code>loc</code> and <code>scale</code> are both scalars.
Otherwise, <code>np.broadcast(loc, scale).size</code> samples are drawn.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">33500</span><span class="p">,</span><span class="mi">150000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">90000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">120000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">48000</span><span class="p">,</span><span class="mi">55000</span><span class="p">,</span><span class="mi">3650</span><span class="p">)],</span> 
			<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1992</span><span class="p">,</span><span class="mi">1993</span><span class="p">,</span><span class="mi">1994</span><span class="p">,</span><span class="mi">1995</span><span class="p">])</span>
</pre></div>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<p>
Comparing the sample to the values fed to the <code>normal</code> function it appears that even with 3,650 values, it's still not exactly what we asked for.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

<p>
1992, the plot with the largest spread looks kind of lumpy. Their means look surprisingly close, but that's probably because the large standaard deviation distorts the scale.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
<p>
The box-plot shows once again that there centers are relatively close. But 1992 and 1994 have considerably more spread than 1993 and especially more than 1995.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org499b145" class="outline-2">
<h2 id="org499b145">Interval Check</h2>
<div class="outline-text-2" id="text-org499b145">
<p>
This is the class that implements the plotting. It colors the bar-plots based on whether the value given is within a bar's confidence interval (white), below the confidence interval (blue) or above the confidence interval (red). It's set up to work with the easiest case so the <code>color_bars</code> method has to be overridden to make it work for this case.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IntervalCheck</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""colors plot based on whether a value is in range</span>
<span class="sd">    Args:</span>
<span class="sd">     data (DataFrame): frame with data of interest as columns</span>
<span class="sd">     confidence_interval (float): probability we want to exceed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">confidence_interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">confidence_interval</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of high and low interval tuples"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>    
	    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">,</span>
						   <span class="n">loc</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
						   <span class="n">scale</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">sem</span><span class="p">())</span>
			       <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the low-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of low-end confidence interval values</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">low</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""high-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of high-end values for confidence intervals</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">high</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">means</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the means of the data-arrays"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The size of the errors, rather than the ci values"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span>

    <span class="k">def</span> <span class="nf">print_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""print org-mode formatted table of the confidence intervals"""</span>
	<span class="n">intervals</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
				      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)},</span>
				     <span class="n">index</span><span class="o">=</span><span class="s2">"low high"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
	<span class="k">try</span><span class="p">:</span>
	    <span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
	<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	    <span class="c1"># not supported</span>
	    <span class="k">pass</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="nf">setup_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">"""sets up the horizontal line, value and bars</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to distributions</span>
<span class="sd">	Returns:</span>
<span class="sd">	 bars (list): collection of bar-plot objects for the data</span>
<span class="sd">	"""</span>
	<span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
	<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

	<span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
	<span class="n">bars</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
	    <span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">x_labels</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
		    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">"facecolor"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">,</span> <span class="s2">"boxstyle"</span><span class="p">:</span> <span class="s2">"round"</span><span class="p">})</span>
	<span class="k">return</span> <span class="n">bars</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
	<span class="sd">"""colors the bars based on the value</span>
<span class="sd">	this is the easiest case</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to the distribution</span>
<span class="sd">	 bars (list): list of bar-plot objects created from data</span>
<span class="sd">	"""</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'crimson'</span><span class="p">)</span>
	    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'w'</span><span class="p">)</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	    <span class="k">else</span><span class="p">:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	<span class="k">return</span>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">"""plots the data and value</span>
<span class="sd">	* blue bar if value above c.i.</span>
<span class="sd">	* white bar if value in c.i.</span>
<span class="sd">	* red bar if value is below c.i.</span>

<span class="sd">	Args:</span>
<span class="sd">	 value (float): what to compare to the data</span>
<span class="sd">	"""</span>
	<span class="n">bars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_bars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">color_bars</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7992fba" class="outline-2">
<h2 id="org7992fba">Harder</h2>
<div class="outline-text-2" id="text-org7992fba">
<p>
This is the class that implements the harder coloring scheme were a gradient is used instead of just three colors.
</p>
/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Harder</span><span class="p">(</span><span class="n">IntervalCheck</span><span class="p">):</span>
    <span class="sd">"""implements the harder problem</span>
<span class="sd">    Uses a gradient instead of just 3 colors</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="nb">super</span><span class="p">(</span><span class="n">Harder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""array of rgb color triples"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="c1"># could have been done with straight fractions</span>
	    <span class="c1"># but I find it easier to think in terms of</span>
	    <span class="c1"># 0..255</span>
	    <span class="n">base</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">51</span><span class="p">))</span>
	    <span class="n">full</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span>
	    <span class="n">blue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">full</span><span class="p">)</span>
	    <span class="n">blue</span> <span class="o">=</span> <span class="n">blue</span><span class="o">/</span><span class="mi">255</span>
	    <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
	    <span class="n">red</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">full</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span>
	    <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="o">/</span><span class="mi">255</span>
	    <span class="n">tail</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:]</span>
	    <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
	    <span class="n">green</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">proportions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""array of upper limits for the value to find the matching color</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
	<span class="sd">"""colors the bars based on the value</span>
<span class="sd">	this is the harder case</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to the distribution</span>
<span class="sd">	 bars (list): list of bar-plot objects created from data</span>
<span class="sd">	"""</span>
	<span class="n">mapped_values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
			 <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">mapped_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mapped_values</span><span class="p">):</span>
	    <span class="k">for</span> <span class="n">p_index</span><span class="p">,</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportions</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">mapped_value</span> <span class="o">&lt;</span> <span class="n">proportion</span><span class="p">:</span>
		    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">p_index</span><span class="p">]</span>
		    <span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		    <span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
		    <span class="k">break</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org53f00aa" class="outline-2">
<h2 id="org53f00aa">Examples</h2>
<div class="outline-text-2" id="text-org53f00aa">
<p>
First, I'll take a look at the values for the confidence intervals so that I can find values to plot. Here are the confidence intervals for the data I created.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">Harder</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">print_intervals</span><span class="p">()</span>
</pre></div>

<p>
Here's a value that is below all the confidence intervals. as you can see, all the bars are red.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">29000</span>
<span class="c1"># value = 33000</span>
<span class="c1"># value = 39974</span>
<span class="c1"># value = 42000</span>
<span class="c1"># value = 48000</span>
<span class="c1"># value = 49600</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot.png" alt="assignment3harderbarplot.png"></p>
</div>

<p>
For the next value 1992 is light blue, so the value is slightly above the mean, while 1994 is light red, so the value is within the confidence interval but below the mean.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">36000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot2.png" alt="assignment3harderbarplot2.png"></p>
</div>

<p>
This next value is at or close to 1993's mean and slightly above 1994's mean.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">39974</span>
<span class="c1"># value = 42000</span>
<span class="c1"># value = 48000</span>
<span class="c1"># value = 49600</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot3.png" alt="assignment3harderbarplot3.png"></p>
</div>

<p>
This next value is within 1993's confidence interval, but it is light blue so it's above the mean.
</p>
/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">42000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot4.png" alt="assignment3harderbarplot4.png"></p>
</div>

<p>
The next value is within 1995's confidence interval but the darker blue indicates that it is nearly above the interval.
</p>

/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">49500</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot5.png" alt="assignment3harderbarplot5.png"></p>
</div>

<p>
And finally, a value that's above all the confidence intervals.
</p>
/home/brunhilde/.virtualenvs/data_science/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="assignment3harderbarplot6.png" alt="assignment3harderbarplot6.png"></p>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/python-visualization-coursera/" rel="tag">python visualization coursera</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../plotting-with-uncertainty-part-i/" rel="prev" title="Plotting With Uncertainty (Part I)">Previous post</a>
            </li>
            <li class="next">
                <a href="../plotting-with-uncertainty-part-iii/" rel="next" title="Plotting With Uncertainty (Part III)">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
