<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Sketches of data explorations.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Science With Python</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/Measures-of-Centrality/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Data Science With Python</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="pages/portland-unemployment-2007-to-2017">Portland Unemployment Visualization</a>
            </li></ul>
</li>
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/Measures-of-Centrality/" class="u-url">Measures of Centrality</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/Measures-of-Centrality/" rel="bookmark"><time class="published dt-published" datetime="2017-09-30T17:56:00-07:00" title="2017-09-30 17:56">2017-09-30 17:56</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In this assignment you will explore measures of centrality on two networks, a friendship network in Part 1, and a blog network in Part 2.</p>
<div class="section" id="part-1-friendships">
<h2>Part 1 - Friendships</h2>
<div class="section" id="imports">
<h3>1.1 Imports</h3>
<pre class="code ipython"><a name="rest_code_0a8b59a83c6a4a2abcf5d13e8fb31274-1"></a><span class="kn">import</span> <span class="nn">networkx</span>
</pre>
</div>
<div class="section" id="friendships-data">
<h3>1.2 Friendships data</h3>
<pre class="code ipython"><a name="rest_code_4d7fdabdf4e34d0fb5c308b05d88c412-1"></a><span class="n">friendships</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="s1">'friendships.gml'</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="question-1">
<h3>1.3 Question 1</h3>
<p>Find the degree centrality, closeness centrality, and normalized betweeness centrality (excluding endpoints) of node 100.</p>
<p><strong>This function should return a tuple of floats ``(degree_centrality, closeness_centrality, betweenness_centrality)``.</strong></p>
<pre class="code ipython"><a name="rest_code_a3dd270f1aad442dad12596ec728daf5-1"></a><span class="n">DEGREE_CENTRALITY</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">friendships</span><span class="p">)</span>
<a name="rest_code_a3dd270f1aad442dad12596ec728daf5-2"></a><span class="n">CLOSENESS_CENTRALITY</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">closeness_centrality</span><span class="p">(</span><span class="n">friendships</span><span class="p">)</span>
<a name="rest_code_a3dd270f1aad442dad12596ec728daf5-3"></a><span class="n">BETWEENNESS_CENTRALITY</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">friendships</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-1"></a><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-2"></a>    <span class="sd">"""gets measures of centrality for node 100</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-3"></a>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-5"></a><span class="sd">     tuple:</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-6"></a><span class="sd">      - float: degree centrality</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-7"></a><span class="sd">      - float: closeness centrality</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-8"></a><span class="sd">      - float: normalized betweeness centrality</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-9"></a><span class="sd">    """</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-10"></a>    <span class="n">NODE</span> <span class="o">=</span> <span class="mi">100</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-11"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">DEGREE_CENTRALITY</span><span class="p">[</span><span class="n">NODE</span><span class="p">],</span>
<a name="rest_code_23312d0250ab4736a4cf2ce29b0c1e48-12"></a>            <span class="n">CLOSENESS_CENTRALITY</span><span class="p">[</span><span class="n">NODE</span><span class="p">],</span> <span class="n">BETWEENNESS_CENTRALITY</span><span class="p">[</span><span class="n">NODE</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_57dc96aa118143ab89a7ebf890d1aa77-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_one</span><span class="p">())</span>
</pre>
<pre class="literal-block">
(0.0026501766784452294, 0.2654784240150094, 7.142902633244772e-05)
</pre>
<p>For Questions 2, 3, and 4, use one of the covered centrality measures to rank the nodes and find the most appropriate candidate.</p>
<pre class="code ipython"><a name="rest_code_c76901c4cb5247e397f7fa053e284750-1"></a><span class="k">def</span> <span class="nf">largest_node</span><span class="p">(</span><span class="n">centrality</span><span class="p">):</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-2"></a>    <span class="sd">"""gets the node with the best (largest score)</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-3"></a>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-5"></a><span class="sd">     int: name of the node with the best score</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-6"></a><span class="sd">    """</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-7"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
<a name="rest_code_c76901c4cb5247e397f7fa053e284750-8"></a>                                <span class="k">for</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">centrality</span><span class="o">.</span><span class="n">items</span><span class="p">())))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre>
</div>
<div class="section" id="question-2">
<h3>1.4 Question 2</h3>
<p>Suppose you are employed by an online shopping website and are tasked with selecting one user in network G1 to send an online shopping voucher to. We expect that the user who receives the voucher will send it to their friends in the network.  You want the voucher to reach as many nodes as possible. The voucher can be forwarded to multiple users at the same time, but the travel distance of the voucher is limited to one step, which means if the voucher travels more than one step in this network, it is no longer valid. Apply your knowledge in network centrality to select the best candidate for the voucher.</p>
<p><strong>This function should return an integer, the name of the node.</strong></p>
<pre class="code ipython"><a name="rest_code_0d5d8b8147494a568ffd090ccaf5cbb8-1"></a><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
<a name="rest_code_0d5d8b8147494a568ffd090ccaf5cbb8-2"></a>    <span class="sd">"""returns the node with the best degree centrality"""</span>
<a name="rest_code_0d5d8b8147494a568ffd090ccaf5cbb8-3"></a>    <span class="k">return</span> <span class="n">largest_node</span><span class="p">(</span><span class="n">DEGREE_CENTRALITY</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_40dbe175266f4404886d6fa2e96e6f38-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_two</span><span class="p">())</span>
</pre>
<pre class="literal-block">
105
</pre>
</div>
<div class="section" id="question-3">
<h3>1.5 Question 3</h3>
<p>Now the limit of the voucher’s travel distance has been removed. Because the network is connected, regardless of who you pick, every node in the network will eventually receive the voucher. However, we now want to ensure that the voucher reaches the nodes in the lowest average number of hops.</p>
<p>How would you change your selection strategy? Write a function to tell us who is the best candidate in the network under this condition.</p>
<p><strong>This function should return an integer, the name of the node.</strong></p>
<pre class="code ipython"><a name="rest_code_e2212e1ef1dc4e2ea1fda25e6800de50-1"></a><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
<a name="rest_code_e2212e1ef1dc4e2ea1fda25e6800de50-2"></a>    <span class="sd">"""Returns the node with the best closeness centrality"""</span>
<a name="rest_code_e2212e1ef1dc4e2ea1fda25e6800de50-3"></a>    <span class="k">return</span> <span class="n">largest_node</span><span class="p">(</span><span class="n">CLOSENESS_CENTRALITY</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_465265b0c2cb46839277301706bb2b1b-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_three</span><span class="p">())</span>
</pre>
<pre class="literal-block">
23
</pre>
</div>
<div class="section" id="question-4">
<h3>1.6 Question 4</h3>
<p>Assume the restriction on the voucher’s travel distance is still removed, but now a competitor has developed a strategy to remove a person from the network in order to disrupt the distribution of your company’s voucher. Identify the single riskiest person to be removed under your competitor’s strategy?</p>
<p><strong>This function should return an integer, the name of the node.</strong></p>
<pre class="code ipython"><a name="rest_code_b82d6cb94e2d4a2399b1a9830d8cabf8-1"></a><span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
<a name="rest_code_b82d6cb94e2d4a2399b1a9830d8cabf8-2"></a>    <span class="sd">"""the node with the highest betweenness centrality"""</span>
<a name="rest_code_b82d6cb94e2d4a2399b1a9830d8cabf8-3"></a>    <span class="k">return</span> <span class="n">largest_node</span><span class="p">(</span><span class="n">BETWEENNESS_CENTRALITY</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_6bd632c08e4b4d73a79453c435b20947-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_four</span><span class="p">())</span>
</pre>
<pre class="literal-block">
333
</pre>
</div>
</div>
<div class="section" id="part-2-political-blogs">
<h2>Part 2 - Political Blogs</h2>
<p><tt class="docutils literal">blogs</tt> is a directed network of political blogs, where nodes correspond to a blog and edges correspond to links between blogs. Use your knowledge of PageRank and HITS to answer Questions 5-9.</p>
<pre class="code ipython"><a name="rest_code_6700b8715aed49348b93ef892a104a8d-1"></a><span class="n">blogs</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="s1">'blogs.gml'</span><span class="p">)</span>
</pre>
<div class="section" id="question-5">
<h3>2.1 Question 5</h3>
<p>Apply the Scaled Page Rank Algorithm to this network. Find the Page Rank of node 'realclearpolitics.com' with damping value 0.85.</p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_e9b4db422af14e03a7666f7b57011898-1"></a><span class="n">PAGE_RANK</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">blogs</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_e0aab162beb04c0a8426e018ebca447a-1"></a><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
<a name="rest_code_e0aab162beb04c0a8426e018ebca447a-2"></a>    <span class="sd">"""Page Rank of realclearpolitics.com"""</span>
<a name="rest_code_e0aab162beb04c0a8426e018ebca447a-3"></a>    <span class="k">return</span> <span class="n">PAGE_RANK</span><span class="p">[</span><span class="s1">'realclearpolitics.com'</span><span class="p">]</span>
</pre>
<pre class="code ipython"><a name="rest_code_2fdaac03ee2b4fe482eabba30261489c-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_five</span><span class="p">())</span>
</pre>
<pre class="literal-block">
0.004636694781649093
</pre>
</div>
<div class="section" id="question-6">
<h3>2.2 Question 6</h3>
<p>Apply the Scaled Page Rank Algorithm to this network with damping value 0.85. Find the 5 nodes with highest Page Rank.</p>
<p><strong>This function should return a list of the top 5 blogs in desending order of Page Rank.</strong></p>
<pre class="code ipython"><a name="rest_code_6be669b4af644402a7bd8fe45f321cd8-1"></a><span class="k">def</span> <span class="nf">top_five</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
<a name="rest_code_6be669b4af644402a7bd8fe45f321cd8-2"></a>    <span class="sd">"""gets the top-five blogs by rank"""</span>
<a name="rest_code_6be669b4af644402a7bd8fe45f321cd8-3"></a>    <span class="n">top</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">rank</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
<a name="rest_code_6be669b4af644402a7bd8fe45f321cd8-4"></a>                               <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">ranks</span><span class="o">.</span><span class="n">items</span><span class="p">())))[:</span><span class="mi">5</span><span class="p">]</span>
<a name="rest_code_6be669b4af644402a7bd8fe45f321cd8-5"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">top</span><span class="p">]</span>
</pre>
<pre class="code ipython"><a name="rest_code_2c29f860ea9548c0a15ced14ed4735ab-1"></a><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
<a name="rest_code_2c29f860ea9548c0a15ced14ed4735ab-2"></a>    <span class="sd">"""Top 5 nodes by page rank"""</span>
<a name="rest_code_2c29f860ea9548c0a15ced14ed4735ab-3"></a>    <span class="k">return</span> <span class="n">top_five</span><span class="p">(</span><span class="n">PAGE_RANK</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_b9dd9fd2fa6140468c572fcb49f96534-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_six</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['dailykos.com', 'atrios.blogspot.com', 'instapundit.com', 'blogsforbush.com', 'talkingpointsmemo.com']
</pre>
</div>
<div class="section" id="question-7">
<h3>2.3 Question 7</h3>
<p>Apply the HITS Algorithm to the network to find the hub and authority scores of node 'realclearpolitics.com'.</p>
<p><strong>Your result should return a tuple of floats `(hub_score, authority_score)`.</strong></p>
<pre class="code ipython"><a name="rest_code_10fe363ca3c549b8a5d5813c11928292-1"></a><span class="n">HUBS</span><span class="p">,</span> <span class="n">AUTHORITIES</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">hits</span><span class="p">(</span><span class="n">blogs</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_ec7c03e549b14fbca1cd779565bf7fbe-1"></a><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
<a name="rest_code_ec7c03e549b14fbca1cd779565bf7fbe-2"></a>    <span class="sd">"""HITS score for realclearpolitics.com"""</span>
<a name="rest_code_ec7c03e549b14fbca1cd779565bf7fbe-3"></a>    <span class="k">return</span> <span class="n">HUBS</span><span class="p">[</span><span class="s1">'realclearpolitics.com'</span><span class="p">],</span> <span class="n">AUTHORITIES</span><span class="p">[</span><span class="s1">'realclearpolitics.com'</span><span class="p">]</span>
</pre>
<pre class="code ipython"><a name="rest_code_e8309f7e26364503b256a092466aab16-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_seven</span><span class="p">())</span>
</pre>
<pre class="literal-block">
(0.0003243556140916669, 0.003918957645699851)
</pre>
</div>
<div class="section" id="question-8">
<h3>2.4 Question 8</h3>
<p>Apply the HITS Algorithm to this network to find the 5 nodes with highest hub scores.</p>
<p><strong>This function should return a list of the top 5 blogs in desending order of hub scores.</strong></p>
<pre class="code ipython"><a name="rest_code_11067149dae842f29b17437fb702281c-1"></a><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
<a name="rest_code_11067149dae842f29b17437fb702281c-2"></a>    <span class="sd">"""Top five blogs by hub scores"""</span>
<a name="rest_code_11067149dae842f29b17437fb702281c-3"></a>    <span class="k">return</span> <span class="n">top_five</span><span class="p">(</span><span class="n">HUBS</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_02f3538824a64a07b7bcb922700ec447-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_eight</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['politicalstrategy.org', 'madkane.com/notable.html', 'liberaloasis.com', 'stagefour.typepad.com/commonprejudice', 'bodyandsoul.typepad.com']
</pre>
<p>Apply the HITS Algorithm to this network to find the 5 nodes with highest authority scores.</p>
<p><strong>This function should return a list of the top 5 blogs in desending order of authority scores.</strong></p>
<pre class="code ipython"><a name="rest_code_f41184eb4baf42deb9450b0c2602b76c-1"></a><span class="k">def</span> <span class="nf">answer_nine</span><span class="p">():</span>
<a name="rest_code_f41184eb4baf42deb9450b0c2602b76c-2"></a>    <span class="sd">"""the top 5 blogs by authorities score"""</span>
<a name="rest_code_f41184eb4baf42deb9450b0c2602b76c-3"></a>    <span class="k">return</span> <span class="n">top_five</span><span class="p">(</span><span class="n">AUTHORITIES</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_888d88e6d054412da2b5c59a1010cda3-1"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_nine</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['dailykos.com', 'talkingpointsmemo.com', 'atrios.blogspot.com', 'washingtonmonthly.com', 'talkleft.com']
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/node-importance/" class="u-url">Node Importance</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/node-importance/" rel="bookmark"><time class="published dt-published" datetime="2017-09-30T17:23:00-07:00" title="2017-09-30 17:23">2017-09-30 17:23</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>When looking at a network one of the things that might be useful is to identify the "important" nodes. Some cases where this would be useful are:</p>
<ul class="simple">
<li>indentifying people who have many connections in a social network</li>
<li>people who are closest to other members of the network</li>
<li>weakest links in the network</li>
</ul>
<pre class="code ipython"><a name="rest_code_b5f8aef86c0740b78e49adeabf10acee-1"></a><span class="c1"># from pypi</span>
<a name="rest_code_b5f8aef86c0740b78e49adeabf10acee-2"></a><span class="kn">import</span> <span class="nn">networkx</span>
</pre>
<pre class="code ipython"><a name="rest_code_29798d8a337f42168094daa3ccb1def4-1"></a><span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
</pre>
</div>
<div class="section" id="degree-centrality-undirected">
<h2>2 Degree Centrality (undirected)</h2>
<p>Degree centrality starts with the assumption that the person with the most connections (edges) is the most important. Rather than returning a count it is the degree of the node divided by the total possible number of edges that the node could have. For the case of the directed graph the degree of the incoming vertices and outgoing vertices would likely be treated separately.</p>
<div class="math">
\begin{equation*}
Centrality_{degree}(v) = \frac{degree_v}{|N| - 1}
\end{equation*}
</div>
<p>Where <em>N</em> is the the graph and <em>v</em> is the vertex (node) that we are measuring.</p>
<ul class="simple">
<li>A <strong>Degree Centrality</strong> of 1 means the node is directly connected to every other node</li>
<li>A <strong>Degree Centrality</strong> of 0 means the node isn't connected to any other node in the network</li>
</ul>
<pre class="code ipython"><a name="rest_code_6527b8458713431886d144b847cce64d-1"></a><span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_6527b8458713431886d144b847cce64d-2"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"AAABDE"</span><span class="p">)</span>
<a name="rest_code_6527b8458713431886d144b847cce64d-3"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"BCEEEF"</span><span class="p">)</span>
<a name="rest_code_6527b8458713431886d144b847cce64d-4"></a><span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
<a name="rest_code_6527b8458713431886d144b847cce64d-5"></a><span class="n">graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
<a name="rest_code_6527b8458713431886d144b847cce64d-6"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="node_importance_graph.png" src="posts/node-importance/node_importance_graph.png"><p>In this graph there are six nodes so each node can have at most 5 links. <tt class="docutils literal">E</tt> has 4 so the degree centrality should be 4/5.</p>
<pre class="code ipython"><a name="rest_code_282f3bdf131e4920b0f67b0016282e3b-1"></a><span class="n">degree_centrality</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a name="rest_code_282f3bdf131e4920b0f67b0016282e3b-2"></a><span class="k">print</span><span class="p">(</span><span class="n">degree_centrality</span><span class="p">)</span>
<a name="rest_code_282f3bdf131e4920b0f67b0016282e3b-3"></a><span class="k">assert</span> <span class="n">degree_centrality</span><span class="p">[</span><span class="s2">"E"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="o">/</span><span class="mi">5</span>
</pre>
<pre class="literal-block">
{'B': 0.4, 'E': 0.8, 'A': 0.6000000000000001, 'C': 0.2, 'D': 0.2, 'F': 0.2}
</pre>
</div>
<div class="section" id="closeness-centrality">
<h2>3 Closeness Centrality</h2>
<p>This measure assumes that the node that is closest to all the other nodes is the most important. It is the ratio of the highest possible degree for the node to the sum of the shortest paths to the other nodes.</p>
<div class="math">
\begin{equation*}
Centrality_{closeness}(v) = \frac{|N| - 1}{\textit{sum of shortest paths of v}}
\end{equation*}
</div>
<p>Looking at <tt class="docutils literal">E</tt> again, you can see that the sum of its shortest paths is 6 so the <strong>closeness centrality</strong> should be 5/6.</p>
<pre class="code ipython"><a name="rest_code_ca91b795007b402eae2ec376a7a5717d-1"></a><span class="n">closeness_centrality</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">closeness_centrality</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a name="rest_code_ca91b795007b402eae2ec376a7a5717d-2"></a><span class="k">print</span><span class="p">(</span><span class="n">closeness_centrality</span><span class="p">)</span>
<a name="rest_code_ca91b795007b402eae2ec376a7a5717d-3"></a><span class="k">assert</span> <span class="n">closeness_centrality</span><span class="p">[</span><span class="s2">"E"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="o">/</span><span class="mi">6</span>
</pre>
<pre class="literal-block">
{'B': 0.625, 'E': 0.8333333333333334, 'A': 0.7142857142857143, 'C': 0.45454545454545453, 'D': 0.5, 'F': 0.5}
</pre>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/connected-components/" class="u-url">Connected Components</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/connected-components/" rel="bookmark"><time class="published dt-published" datetime="2017-09-24T15:44:00-07:00" title="2017-09-24 15:44">2017-09-24 15:44</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<pre class="code ipython"><a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-1"></a><span class="c1"># pypi</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-2"></a><span class="kn">import</span> <span class="nn">networkx</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-3"></a><span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-4"></a>    <span class="n">draw</span><span class="p">,</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-5"></a>    <span class="n">DiGraph</span><span class="p">,</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-6"></a>    <span class="n">Graph</span><span class="p">,</span>
<a name="rest_code_b7fd5ce0390c4a859ba875481259e04b-7"></a><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_2ea9a441d13c4bb8aefc75548a151a82-1"></a><span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
</pre>
<div class="section" id="undirected-graphs">
<h2>1 Undirected Graphs</h2>
<div class="section" id="connected-graphs">
<h3>1.1 Connected Graphs</h3>
<p>An unconnected graph is <cite>connected</cite> if every pair of nodes has a path between them.</p>
<pre class="code ipython"><a name="rest_code_2fa9bc7c016441c9941156de9db92565-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"AAAAABBCDFFFGGGHIJKKKLLLN"</span><span class="p">)</span>
<a name="rest_code_2fa9bc7c016441c9941156de9db92565-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"BECGNCDDEGIJHIJIJOLMOMNOO"</span><span class="p">)</span>
<a name="rest_code_2fa9bc7c016441c9941156de9db92565-3"></a><span class="n">undirected</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_2fa9bc7c016441c9941156de9db92565-4"></a><span class="n">undirected</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_2fa9bc7c016441c9941156de9db92565-5"></a><span class="n">draw</span><span class="p">(</span><span class="n">undirected</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="connected_example.png" src="posts/connected-components/connected_example.png"><p>Is this graph connected? It looks like it, since every node has an edge to it.</p>
<pre class="code ipython"><a name="rest_code_cd90a0c80af94e87b769341b7f4a7fd7-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="n">undirected</span><span class="p">))</span>
</pre>
<pre class="literal-block">
True
</pre>
<p>To make this graph unconnected you need to remove some edges that connect sub-graphs.</p>
<pre class="code ipython"><a name="rest_code_71861381de644bc89ab308303e2fd694-1"></a><span class="n">undirected</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">([(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"G"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"N"</span><span class="p">)])</span>
<a name="rest_code_71861381de644bc89ab308303e2fd694-2"></a><span class="n">draw</span><span class="p">(</span><span class="n">undirected</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="unconnected.png" src="posts/connected-components/unconnected.png"><pre class="code ipython"><a name="rest_code_bcc75cd992e24e5081a7346a61d49172-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="n">undirected</span><span class="p">))</span>
</pre>
<pre class="literal-block">
False
</pre>
</div>
<div class="section" id="connected-components">
<h3>1.2 Connected Components</h3>
<p>A connected component is a subset of nodes where:</p>
<ul class="simple">
<li>Every node in the subset has a path to every other node</li>
<li>No node outside the subset has a path to a node in the subset</li>
</ul>
<p>Let's break the graph a little more.</p>
<pre class="code ipython"><a name="rest_code_3d09e64ff51442469f258db5b5350974-1"></a><span class="n">undirected</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="s2">"J"</span><span class="p">,</span> <span class="s2">"O"</span><span class="p">)</span>
<a name="rest_code_3d09e64ff51442469f258db5b5350974-2"></a><span class="n">draw</span><span class="p">(</span><span class="n">undirected</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="unconnected_2.png" src="posts/connected-components/unconnected_2.png"><p>We now have three connected components.</p>
<pre class="code ipython"><a name="rest_code_24cbaa44396c4395819eedce1473d5e4-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">number_connected_components</span><span class="p">(</span><span class="n">undirected</span><span class="p">))</span>
</pre>
<pre class="literal-block">
3
</pre>
<p>Which we can inspect.</p>
<pre class="code ipython"><a name="rest_code_8d680aff23f348ef99321ec56169958a-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">undirected</span><span class="p">):</span>
<a name="rest_code_8d680aff23f348ef99321ec56169958a-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'J', 'I', 'G', 'H', 'F'}
{'N', 'M', 'O', 'K', 'L'}
{'D', 'B', 'C', 'E', 'A'}
</pre>
<p>We can also pick out a node from one of the components and get the sub-set.</p>
<pre class="code ipython"><a name="rest_code_e1f014d74829467b86b359a84dc8bfb9-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">node_connected_component</span><span class="p">(</span><span class="n">undirected</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">))</span>
</pre>
<pre class="literal-block">
{'B', 'D', 'C', 'A', 'E'}
</pre>
<p>Which you can see is the third connected component in the example above.</p>
</div>
</div>
<div class="section" id="directed-graphs">
<h2>2 Directed Graphs</h2>
<p>Directed graphs have similar ideas with regard to connectivity when compared to undirected graphs, but with a <strong>strong</strong> and <strong>weak</strong> version for each.</p>
<div class="section" id="strongly-connected">
<h3>2.1 Strongly Connected</h3>
<p>A <em>strongly connected</em> graph is a directed graph where for every pair of nodes there is a directed path in both directions.</p>
<pre class="code ipython"><a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"AABCDD"</span><span class="p">)</span>
<a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"BDDBCA"</span><span class="p">)</span>
<a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-3"></a>
<a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-4"></a><span class="n">directed</span> <span class="o">=</span> <span class="n">DiGraph</span><span class="p">()</span>
<a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-5"></a><span class="n">directed</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_e2127f74e9774a35b0a2b1a7f28c719d-6"></a><span class="n">draw</span><span class="p">(</span><span class="n">directed</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="directed_graph.png" src="posts/connected-components/directed_graph.png"><p>For some reason <tt class="docutils literal">networkx</tt> uses boxes instead of arrow-heads, but hopefully you get the idea.</p>
<pre class="code ipython"><a name="rest_code_d44b07bd912c44ed814ff4c46b6c9cf4-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_strongly_connected</span><span class="p">(</span><span class="n">directed</span><span class="p">))</span>
</pre>
<pre class="literal-block">
True
</pre>
</div>
<div class="section" id="weakly-connected">
<h3>2.2 Weakly Connected</h3>
<p>A directed graph is <em>weakly connected</em> if, when all the edges are replaced by undirected edges
(converting it to an undirected graph) then the graph is <em>connected</em>.</p>
<pre class="code ipython"><a name="rest_code_5c74aecdc1144766b9c2cde4105f076f-1"></a><span class="n">directed</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">)</span>
<a name="rest_code_5c74aecdc1144766b9c2cde4105f076f-2"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_strongly_connected</span><span class="p">(</span><span class="n">directed</span><span class="p">))</span>
<a name="rest_code_5c74aecdc1144766b9c2cde4105f076f-3"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_weakly_connected</span><span class="p">(</span><span class="n">directed</span><span class="p">))</span>
</pre>
<pre class="literal-block">
False
True
</pre>
<pre class="code ipython"><a name="rest_code_c0414a5707a24f44a31c0f5d146aadbe-1"></a><span class="n">draw</span><span class="p">(</span><span class="n">directed</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="directed_weak.png" src="posts/connected-components/directed_weak.png"><p>Our new graph isn't <em>strongly connected</em> because there's no path from B to A (or B to C, etc.). But it is <em>weakly connected</em> since removing the directions just makes it a loop.</p>
</div>
<div class="section" id="strongly-connected-component">
<h3>2.3 Strongly Connected Component</h3>
<p>This is a subset of nodes in a directed graph where:</p>
<ul class="simple">
<li>Every node in the subset has a directed path to every other node</li>
<li>No node outside the subset has a directed path to and from every node in the subset</li>
</ul>
<pre class="code ipython"><a name="rest_code_c4d3db650d4b43b98f500534847e2aae-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"ADDDEFFFFGGH"</span><span class="p">)</span>
<a name="rest_code_c4d3db650d4b43b98f500534847e2aae-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"HBFGGABGHHCE"</span><span class="p">)</span>
<a name="rest_code_c4d3db650d4b43b98f500534847e2aae-3"></a><span class="n">directed_2</span> <span class="o">=</span> <span class="n">DiGraph</span><span class="p">()</span>
<a name="rest_code_c4d3db650d4b43b98f500534847e2aae-4"></a><span class="n">directed_2</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_c4d3db650d4b43b98f500534847e2aae-5"></a><span class="n">draw</span><span class="p">(</span><span class="n">directed_2</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="directed_2.png" src="posts/connected-components/directed_2.png"><pre class="code ipython"><a name="rest_code_3fab93553a9648a988bb9c9943a94d96-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">is_strongly_connected</span><span class="p">(</span><span class="n">directed_2</span><span class="p">))</span>
</pre>
<pre class="literal-block">
False
</pre>
<p>You can see that the graph is not strongly connected (there's no path to E, for instance) but is there a strongly connected component within it?</p>
<pre class="code ipython"><a name="rest_code_27b12732295244ad9ce1e6c7e7a6f0f1-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">directed_2</span><span class="p">):</span>
<a name="rest_code_27b12732295244ad9ce1e6c7e7a6f0f1-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'C'}
{'H', 'G', 'E'}
{'A'}
{'B'}
{'F'}
{'D'}
</pre>
<p>In this case H, G, and E are a strongly connected component (as are each of the other individual nodes). What if we add a path from B to D?</p>
<pre class="code ipython"><a name="rest_code_6e158d6fd4fd443bbb835571ae872fc5-1"></a><span class="n">directed_2</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">)</span>
<a name="rest_code_6e158d6fd4fd443bbb835571ae872fc5-2"></a><span class="n">draw</span><span class="p">(</span><span class="n">directed_2</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="directed_3.png" src="posts/connected-components/directed_3.png"><pre class="code ipython"><a name="rest_code_2d1c520264b94b348129908ad808b242-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">directed_2</span><span class="p">):</span>
<a name="rest_code_2d1c520264b94b348129908ad808b242-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'C'}
{'H', 'G', 'E'}
{'A'}
{'B', 'F', 'D'}
</pre>
<p>Now there are two interesting strongly connected components and two not so interesting ones.</p>
</div>
<div class="section" id="weakly-connected-components">
<h3>2.4 Weakly Connected Components</h3>
<p>A <em>weakly connected component</em> is one where a directed graph is converted into an undirected graph and the sub-set of nodes is a connected component.</p>
<pre class="code ipython"><a name="rest_code_9ec1a7ab4e154f0391736db515435937-1"></a><span class="n">directed_2</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">([(</span><span class="s2">"F"</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"F"</span><span class="p">,</span> <span class="s2">"H"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"F"</span><span class="p">,</span> <span class="s2">"G"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"G"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"E"</span><span class="p">,</span> <span class="s2">"G"</span><span class="p">)])</span>
<a name="rest_code_9ec1a7ab4e154f0391736db515435937-2"></a><span class="n">directed_2</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">"G"</span><span class="p">,</span> <span class="s2">"E"</span><span class="p">)</span>
<a name="rest_code_9ec1a7ab4e154f0391736db515435937-3"></a><span class="n">draw</span><span class="p">(</span><span class="n">directed_2</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="weakly_connected_component.png" src="posts/connected-components/weakly_connected_component.png"><pre class="code ipython"><a name="rest_code_7de4414f1511463ea61700bd4e8ecbae-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">directed_2</span><span class="p">):</span>
<a name="rest_code_7de4414f1511463ea61700bd4e8ecbae-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'C'}
{'E'}
{'H'}
{'A'}
{'B'}
{'F'}
{'D'}
{'G'}
</pre>
<pre class="code ipython"><a name="rest_code_7a80be05186642f2b5603f1ff4a0f511-1"></a><span class="n">undirected_2</span> <span class="o">=</span> <span class="n">directed_2</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
<a name="rest_code_7a80be05186642f2b5603f1ff4a0f511-2"></a><span class="n">draw</span><span class="p">(</span><span class="n">undirected_2</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="undirected_weak.png" src="posts/connected-components/undirected_weak.png"><p>Looking at the converted graph you can see that there are two connected components.</p>
<pre class="code ipython"><a name="rest_code_716d01836301450f831b80dfc1417770-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">undirected_2</span><span class="p">):</span>
<a name="rest_code_716d01836301450f831b80dfc1417770-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'A', 'H', 'G', 'C', 'E'}
{'D', 'B', 'F'}
</pre>
<p>An important thing to note is that A and C are part of their connected component, even though visually they look like they're dangling out there.</p>
<p>You can also skip the conversion and let network x do it for you.</p>
<pre class="code ipython"><a name="rest_code_17dddd5dc54b411491bbc42dbabfd3ce-1"></a><span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">weakly_connected_components</span><span class="p">(</span><span class="n">directed_2</span><span class="p">):</span>
<a name="rest_code_17dddd5dc54b411491bbc42dbabfd3ce-2"></a>    <span class="k">print</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'G', 'C', 'H', 'E', 'A'}
{'B', 'F', 'D'}
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/distance-in-social-networks/" class="u-url">Distance in Social Networks</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/distance-in-social-networks/" rel="bookmark"><time class="published dt-published" datetime="2017-09-24T12:49:00-07:00" title="2017-09-24 12:49">2017-09-24 12:49</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>When characterizing a graph one of the things to look at is how far apart the nodes are.</p>
<pre class="code ipython"><a name="rest_code_d21ee2832b9b4c0a9ac6a707fe81829e-1"></a><span class="c1"># from pypi</span>
<a name="rest_code_d21ee2832b9b4c0a9ac6a707fe81829e-2"></a><span class="kn">import</span> <span class="nn">networkx</span>
</pre>
<p>This will be the example network.</p>
<pre class="code ipython"><a name="rest_code_a9c9b21ca6f64d028bc6b99c5497c014-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"AAKBCCFEDEIE"</span><span class="p">)</span>
<a name="rest_code_a9c9b21ca6f64d028bc6b99c5497c014-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"KBBCFEGFEIJH"</span><span class="p">)</span>
<a name="rest_code_a9c9b21ca6f64d028bc6b99c5497c014-3"></a><span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_a9c9b21ca6f64d028bc6b99c5497c014-4"></a><span class="n">graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_a9c9b21ca6f64d028bc6b99c5497c014-5"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="distance_example.png" src="posts/distance-in-social-networks/distance_example.png">
</div>
<div class="section" id="defining-distance">
<h2>2 Defining Distance</h2>
<p>This section will look at how we can measure the distance between nodes.</p>
<div class="section" id="paths">
<h3>2.1 Paths</h3>
<p>A path is a sequence of nodes connected by edges. One path from D to K might be D-E-C-B-K.</p>
<pre class="code ipython"><a name="rest_code_352ae469e02b4ed1b811e60fabcaa160-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">'DECB'</span><span class="p">)</span>
<a name="rest_code_352ae469e02b4ed1b811e60fabcaa160-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"ECBK"</span><span class="p">)</span>
<a name="rest_code_352ae469e02b4ed1b811e60fabcaa160-3"></a><span class="n">path</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_352ae469e02b4ed1b811e60fabcaa160-4"></a><span class="n">path</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_352ae469e02b4ed1b811e60fabcaa160-5"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="example_path.png" src="posts/distance-in-social-networks/example_path.png">
</div>
<div class="section" id="distance">
<h3>2.2 Distance</h3>
<ul class="simple">
<li>The <em>length</em> of a <em>path</em> is the number of edges in it.</li>
<li>The <em>distance</em> between two nodes is the length of the <em>shortest</em> path between them.</li>
</ul>
<pre class="code ipython"><a name="rest_code_acbd8c5cc4b043319d08e31c751cc241-1"></a><span class="n">dk_shortest_path</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">,</span> <span class="s2">"K"</span><span class="p">)</span>
<a name="rest_code_acbd8c5cc4b043319d08e31c751cc241-2"></a><span class="k">print</span><span class="p">(</span><span class="n">dk_shortest_path</span><span class="p">)</span>
</pre>
<pre class="literal-block">
['D', 'E', 'C', 'B', 'K']
</pre>
<pre class="code ipython"><a name="rest_code_620396f3cf9f429182450fe0a68234f9-1"></a><span class="n">length</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">,</span> <span class="s2">"K"</span><span class="p">)</span>
<a name="rest_code_620396f3cf9f429182450fe0a68234f9-2"></a><span class="k">print</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
<a name="rest_code_620396f3cf9f429182450fe0a68234f9-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dk_shortest_path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">networkx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">,</span> <span class="s2">"K"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
4
</pre>
<p>As you can see the path we saw earlier is the shortest path and the distance from D to K is 4.</p>
</div>
<div class="section" id="breadth-first-search">
<h3>2.3 Breadth-First Search</h3>
<p>One way to compute the distances from one node to all the other nodes is to create a tree using Breadth-First-search. Breadth-First search will eliminate any cycles and leave us with the shortest paths to each node.</p>
<p>This is the tree created for the node A.</p>
<pre class="code ipython"><a name="rest_code_1776321c81854d9f8e2166cd58b30dac-1"></a><span class="n">tree</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">bfs_tree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">)</span>
<a name="rest_code_1776321c81854d9f8e2166cd58b30dac-2"></a><span class="n">positions</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">"dot"</span><span class="p">)</span>
<a name="rest_code_1776321c81854d9f8e2166cd58b30dac-3"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="example_bfs.png" src="posts/distance-in-social-networks/example_bfs.png"><pre class="code ipython"><a name="rest_code_b1735355cd6b42d399da6dfefb4c2c2b-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">))</span>
</pre>
<pre class="literal-block">
{'J': 5, 'D': 4, 'H': 4, 'F': 3, 'K': 1, 'A': 0, 'B': 1, 'C': 2, 'E': 3, 'G': 4, 'I': 4}
</pre>
<p>Looking at the shortest path-lengths to <em>A</em>, you can see that <em>J</em> is is the furthest away, with 5 edges separating them, while <em>B</em> and <em>K</em> are the closest with only 1 hop.</p>
</div>
</div>
<div class="section" id="graph-distance">
<h2>3 Graph Distance</h2>
<p>This looks at how you can answer questions about the graph as a whole.</p>
<div class="section" id="average-distance">
<h3>3.1 Average Distance</h3>
<p>One measure is the average of the distances between ever pair of nodes.</p>
<pre class="code ipython"><a name="rest_code_a4edfabca0bc40eb950c6f83ab29d491-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">average_shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
2.5272727272727273
</pre>
<p>The average distance for our example is around two and a half edges.</p>
</div>
<div class="section" id="diameter">
<h3>3.2 Diameter</h3>
<p>The <em>diameter</em> of a graph is the maximum distance between any of the pairs of nodes. Note that <em>distance</em> is always the shortest path between nodes, so this isn't the longest path in the graph.</p>
<pre class="code ipython"><a name="rest_code_7972d484608a4c1495eff1f3425bcefa-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">diameter</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
5
</pre>
<p>The greatest distance is 5 hops in our example.</p>
</div>
<div class="section" id="eccentricity">
<h3>3.3 Eccentricity</h3>
<p>This is the largest distance between a node and all the other nodes.</p>
<pre class="code ipython"><a name="rest_code_7b0063d35849427b98beeaa00ef865d2-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
{'J': 5, 'D': 4, 'H': 4, 'F': 3, 'K': 5, 'A': 5, 'B': 4, 'C': 3, 'E': 3, 'G': 4, 'I': 4}
</pre>
<p>Looking at the output we can see that A, J, and K all have eccentricities matching the diameter. According to <a class="reference external" href="http://www.etymonline.com/index.php?term=eccentric&amp;allowed_in_frame=0">the Online Etymology Dictionary</a>, <em>eccentric</em> means an orbiting object that doesn't have the earth at the center of its orbit. More literally, it means out of center (or off center).</p>
</div>
<div class="section" id="radius">
<h3>3.4 Radius</h3>
<p>The radius is the minimum eccentricity in a graph.</p>
<pre class="code ipython"><a name="rest_code_f3ccce521ef94525b8bb4c411357dadc-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">radius</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
3
</pre>
<p>So the <em>radius</em> is the smallest of the largest distances for all the nodes.</p>
</div>
<div class="section" id="periphery">
<h3>3.5 Periphery</h3>
<p>This is the set of nodes whose <em>eccentricity</em> is equal to the <em>diameter</em> (5 in our case).</p>
<pre class="code ipython"><a name="rest_code_3bd2b407a2e9447f8a2c7aef480d3139-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">periphery</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
['J', 'K', 'A']
</pre>
<p>Looking at the output and the graph, the diameter of the graph is the distance from A to J or K to J.</p>
</div>
<div class="section" id="center">
<h3>3.6 Center</h3>
<p>This is the set of nodes whose <em>eccentricity</em> is equal to the <em>radius</em> of the graph (3 in this example).</p>
<pre class="code ipython"><a name="rest_code_7dbd1561eceb4e64845a0fc85f609be0-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre>
<pre class="literal-block">
['F', 'C', 'E']
</pre>
<pre class="code ipython"><a name="rest_code_f980e4590227482da42382c86e9d7cb3-1"></a><span class="n">positions</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">"dot"</span><span class="p">)</span>
<a name="rest_code_f980e4590227482da42382c86e9d7cb3-2"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="center.png" src="posts/distance-in-social-networks/center.png"><p>Looking at the graph, you can see that F, C, and, E do in fact form the center triangle.</p>
</div>
</div>
<div class="section" id="karate-club">
<h2>4 Karate Club</h2>
<p>This looks at the network created by the relationships between members of a karate club that is on the verge of splitting up. Each node is a member of the club and the edges represent that the incident edges interacted with each other outside of the club (and were thus assumed to be friends). Members who didn't interact with each other outside of the club aren't represented in the data set.</p>
<p>The instructor wanted to raise fees while the officers didn't. Eventually the instructor was fired and his supporters left with him.</p>
<pre class="code ipython"><a name="rest_code_37492b5da63045ffa92c6a0a035300b1-1"></a><span class="n">karate</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">karate_club_graph</span><span class="p">()</span>
<a name="rest_code_37492b5da63045ffa92c6a0a035300b1-2"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">karate</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="karate.png" src="posts/distance-in-social-networks/karate.png"><pre class="code ipython"><a name="rest_code_b2579a8461114a03859bd23be4cecbbc-1"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_circular</span><span class="p">(</span><span class="n">karate</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="karate_circle.png" src="posts/distance-in-social-networks/karate_circle.png"><p>You can see that there are some central characters in the club, notably 0, 32, and 33.</p>
<pre class="code ipython"><a name="rest_code_abfdab2f98fb4fe7a0e43eb5476c6290-1"></a><span class="n">degrees</span> <span class="o">=</span> <span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">karate</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">node</span><span class="p">))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">karate</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
<a name="rest_code_abfdab2f98fb4fe7a0e43eb5476c6290-2"></a><span class="n">degrees</span> <span class="o">=</span> <span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">degrees</span> <span class="k">if</span> <span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_abfdab2f98fb4fe7a0e43eb5476c6290-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Node</span><span class="se">\t</span><span class="s2">Degree"</span><span class="p">)</span>
<a name="rest_code_abfdab2f98fb4fe7a0e43eb5476c6290-4"></a><span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">:</span>
<a name="rest_code_abfdab2f98fb4fe7a0e43eb5476c6290-5"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"{}</span><span class="se">\t</span><span class="s2">{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">degree</span><span class="p">))</span>
</pre>
<table border="1" class="docutils">
<colgroup>
<col width="40%">
<col width="60%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head">Node</th>
<th class="head">Degree</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>0</td>
<td>16</td>
</tr>
<tr>
<td>32</td>
<td>12</td>
</tr>
<tr>
<td>33</td>
<td>17</td>
</tr>
</tbody>
</table>
<p>The cut-off of 10 degrees was somewhat arbitrary, there are two nodes with degrees 9 and 10 respectively, but you can see that these three nodes were the most connected members of the club.</p>
<div class="section" id="what-is-the-average-distance">
<h3>4.1 What is the average distance?</h3>
<pre class="code ipython"><a name="rest_code_eb5ad43c4eb14cfdbd8a4d163ec2f9a4-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">average_shortest_path_length</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
2.4
</pre>
<p>The path lengths are relatively short, on average.</p>
</div>
<div class="section" id="id1">
<h3>4.2 Diameter</h3>
<pre class="code ipython"><a name="rest_code_f6614dc57fce48fe939b5172bbb4c2e9-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">diameter</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
5
</pre>
<p>The maximum distance is 5.</p>
</div>
<div class="section" id="id2">
<h3>4.3 Eccentricity</h3>
<pre class="code ipython"><a name="rest_code_303d97d22056494cb3c52c831380f887-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
{0: 3, 1: 3, 2: 3, 3: 3, 4: 4, 5: 4, 6: 4, 7: 4, 8: 3, 9: 4, 10: 4, 11: 4, 12: 4, 13: 3, 14: 5, 15: 5, 16: 5, 17: 4, 18: 5, 19: 3, 20: 5, 21: 4, 22: 5, 23: 5, 24: 4, 25: 4, 26: 5, 27: 4, 28: 4, 29: 5, 30: 4, 31: 3, 32: 4, 33: 4}
</pre>
</div>
<div class="section" id="id3">
<h3>4.4 Radius</h3>
<p>What is the smallest eccentricity?</p>
<pre class="code ipython"><a name="rest_code_b8fcb077a87c4eef9e9e0d9434836f9c-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">radius</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
3
</pre>
</div>
<div class="section" id="id4">
<h3>4.5 Periphery</h3>
<p>Which nodes are furthest apart?</p>
<pre class="code ipython"><a name="rest_code_f7b2a6ee38224dc9a454930fdc33d844-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">periphery</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
[14, 15, 16, 18, 20, 22, 23, 26, 29]
</pre>
</div>
<div class="section" id="id5">
<h3>4.6 Center</h3>
<pre class="code ipython"><a name="rest_code_4e719a7eb8a34e0e9125c3eb09585064-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">karate</span><span class="p">))</span>
</pre>
<pre class="literal-block">
[0, 1, 2, 3, 8, 13, 19, 31]
</pre>
<p>The center nodes are most likely the ones that kept information flowing between the two factions (although node 0 is in here as well).</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/triadic-closure/" class="u-url">Triadic Closure (Clustering)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/triadic-closure/" rel="bookmark"><time class="published dt-published" datetime="2017-09-23T16:48:00-07:00" title="2017-09-23 16:48">2017-09-23 16:48</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>Introduction</h2>
<p><strong>Triadic Closure</strong> is a measure of the tendency of edges in a graph to form triangles. It's a measure of the degree to which nodes in a graph tend to cluster together (<a class="reference external" href="https://en.wikipedia.org/wiki/Clustering_coefficient">wikipedia on clustering coefficents</a>).</p>
<pre class="code ipython"><a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-1"></a><span class="c1"># python standard library</span>
<a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-2"></a><span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-3"></a>
<a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-4"></a><span class="c1"># pypi</span>
<a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-5"></a><span class="kn">import</span> <span class="nn">networkx</span>
<a name="rest_code_8f44b6e80ac34463a93e449c8818dbda-6"></a><span class="kn">import</span> <span class="nn">seaborn</span>
</pre>
<pre class="code ipython"><a name="rest_code_12e3495cfce04725b8873559698c290b-1"></a><span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_12e3495cfce04725b8873559698c290b-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_ecb5cf9996ea4fd5a0b3aa2b7b075521-1"></a><span class="n">sample_graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_ecb5cf9996ea4fd5a0b3aa2b7b075521-2"></a><span class="n">sample_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>
<a name="rest_code_ecb5cf9996ea4fd5a0b3aa2b7b075521-3"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">sample_graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="triadic_closure.png" src="posts/triadic-closure/triadic_closure.png"><p>In this case we might say that the likelihood that the next edge will be between 1 and 4 or 1 and 5 is greater than the likelihood that it will form between 4 and 5 or 2 and 5.</p>
</div>
<div class="section" id="local-clustering-coefficient">
<h2>2 Local Clustering Coefficient</h2>
<p>The <strong>Local Clustering Coefficient</strong> is a measure of clustering for a single node. It is the number of pairs of a node's friends that are themselves friends divided by the total number of pairs of a node's friends. This can be interpreted as measuring how close the node's neighbors are to being a complete graph (<a class="reference external" href="https://en.wikipedia.org/wiki/Clustering_coefficient#Local_clustering_coefficient">wikipedia</a>).</p>
<div class="math">
\begin{equation*}
LCC = \frac{\textit{number of pairs of a node's friends that are friends (PTAF)}}{\textit{number of pairs of the node's friends (POF)}}
\end{equation*}
</div>
<pre class="code ipython"><a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-1"></a><span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-2"></a><span class="n">graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"K"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-3"></a>                      <span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"K"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-4"></a>                      <span class="p">(</span><span class="s2">"C"</span><span class="p">,</span> <span class="s2">"E"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"C"</span><span class="p">,</span> <span class="s2">"F"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-5"></a>                      <span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"E"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-6"></a>                      <span class="p">(</span><span class="s2">"E"</span><span class="p">,</span> <span class="s2">"F"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"E"</span><span class="p">,</span> <span class="s2">"H"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-7"></a>                      <span class="p">(</span><span class="s2">"F"</span><span class="p">,</span> <span class="s2">"G"</span><span class="p">),</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-8"></a>                      <span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="s2">"J"</span><span class="p">)])</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-9"></a>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-10"></a>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-11"></a>                      <span class="o">..</span> <span class="n">ggcode</span><span class="p">::</span> <span class="n">ipython</span>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-12"></a>
<a name="rest_code_d1651c7ea12d472f902b6498bb3d4a06-13"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="triadic_example.png" src="posts/triadic-closure/triadic_example.png"><p>The number of pairs of friends can be calculated from the degree of the node.</p>
<div class="math">
\begin{equation*}
POF = \frac{d(d-1)}{2}
\end{equation*}
</div>
<p>Looking at node C, it has degree four so the number of pairs of friends it has is <span class="math">\(\frac{4(3)}{2} = 6\)</span>. Looking at the graph you can see that there are two edges between the nodes connected to it - (A,B) and (E, F), so the clustering coefficient for node C is <span class="math">\(\frac{PTAF}{POF}=\frac{2}{6}\)</span> which reduces to 1/3. We can double check this with networkx.</p>
<pre class="code ipython"><a name="rest_code_f97a8214089d44a09b3f5bde030c1497-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.3333333333333333
</pre>
<p>If you don't pass in the node label to <tt class="docutils literal">networkx.clustering</tt> the function will return a dictionary with all the clustering coefficients, which might be useful if you need to make multiple queries and have a large graph.</p>
<div class="section" id="one-friend">
<h3>2.1 One Friend</h3>
<p>If you look at nodes I and J, they don't have any pairs of friends, just one friend each. This puts a zero in the denominator of the clustering coefficient, making it undefined, but to make it mathematically useful it is given a 0 instead.</p>
<pre class="code ipython"><a name="rest_code_aa1535770c0c4647bf2ff15930a7bfef-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">"I"</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.0
</pre>
</div>
</div>
<div class="section" id="the-whole-network">
<h2>3 The Whole Network</h2>
<p>There's two ways to calculate a clustering coefficient for the entire network. One is to take the average of all the local clustering coefficients, the other is to calculate the percentage of open triads (three nodes connected by two edges) that are triangles.</p>
<div class="section" id="averaging">
<h3>3.1 Averaging</h3>
<p>This is what wikipedia calls the <a class="reference external" href="https://en.wikipedia.org/wiki/Clustering_coefficient#Network_average_clustering_coefficient">network average clustering coefficient</a>.</p>
<pre class="code ipython"><a name="rest_code_f17eb6489ebe4c13907636c12df0b7c3-1"></a><span class="n">coefficients</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<a name="rest_code_f17eb6489ebe4c13907636c12df0b7c3-2"></a><span class="n">average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">coefficients</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>
<a name="rest_code_f17eb6489ebe4c13907636c12df0b7c3-3"></a><span class="k">print</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
<a name="rest_code_f17eb6489ebe4c13907636c12df0b7c3-4"></a><span class="k">assert</span> <span class="n">average</span> <span class="o">==</span> <span class="n">networkx</span><span class="o">.</span><span class="n">average_clustering</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre>
<pre class="literal-block">
0.28787878787878785
</pre>
</div>
<div class="section" id="transitivity">
<h3>3.2 Transitivity</h3>
<p>This is also called the <a class="reference external" href="https://en.wikipedia.org/wiki/Clustering_coefficient#Global_clustering_coefficient">global clustering coefficient</a>.</p>
<p>A <em>triangle</em> is a set of three nodes with three edges connecting them.  An <em>open triad</em> is a set of three nodes with only two edges connecting them. Each triangle has three open triads embedded in it. <em>Transivity</em> is a measure of the percentage of open triads that are triangles.</p>
<p>This triangle:</p>
<pre class="code ipython"><a name="rest_code_dbccde1a43154bbd8b3b7efe5671df5f-1"></a><span class="n">triangle</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_dbccde1a43154bbd8b3b7efe5671df5f-2"></a><span class="n">triangle</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">)])</span>
<a name="rest_code_dbccde1a43154bbd8b3b7efe5671df5f-3"></a>
<a name="rest_code_dbccde1a43154bbd8b3b7efe5671df5f-4"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="tc_one.png" src="posts/triadic-closure/tc_one.png"><p>Contains these open triads.</p>
<pre class="code ipython"><a name="rest_code_1e7b13817bfe429f8b266836359df434-1"></a><span class="n">one</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_1e7b13817bfe429f8b266836359df434-2"></a><span class="n">one</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">)])</span>
<a name="rest_code_1e7b13817bfe429f8b266836359df434-3"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="tc_a.png" src="posts/triadic-closure/tc_a.png"><pre class="code ipython"><a name="rest_code_c557edaeb7374b639d816181d9930deb-1"></a><span class="n">two</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_c557edaeb7374b639d816181d9930deb-2"></a><span class="n">two</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">)])</span>
<a name="rest_code_c557edaeb7374b639d816181d9930deb-3"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">two</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="tc_b.png" src="posts/triadic-closure/tc_b.png"><pre class="code ipython"><a name="rest_code_313edec5827949bc8fd4b9d4e415bc4e-1"></a><span class="n">three</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_313edec5827949bc8fd4b9d4e415bc4e-2"></a><span class="n">three</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">)])</span>
<a name="rest_code_313edec5827949bc8fd4b9d4e415bc4e-3"></a><span class="n">three</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">)])</span>
<a name="rest_code_313edec5827949bc8fd4b9d4e415bc4e-4"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">three</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="tc_c.png" src="posts/triadic-closure/tc_c.png"><p>So the transitivity is three times the count of triangles in the graph divided by all the open triads in the graph.</p>
<div class="math">
\begin{equation*}
transitivity = \frac{3 \times \|\textit{triangles}\|}{\|\textit{open triads}\|}
\end{equation*}
</div>
<p>Looking at our earlier example you can see that there are three triangles and thirteen open triads (to be honest I only found 10).</p>
<pre class="code ipython"><a name="rest_code_c8c5c859be384511acd732d2c42f316c-1"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="triadic_example.png" src="posts/triadic-closure/triadic_example.png"><pre class="code ipython"><a name="rest_code_2e0eb9b26a2a4f9ca334c701ef2a7681-1"></a><span class="n">transitivity</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">13</span><span class="p">)</span>
<a name="rest_code_2e0eb9b26a2a4f9ca334c701ef2a7681-2"></a><span class="k">print</span><span class="p">(</span><span class="n">transitivity</span><span class="p">)</span>
<a name="rest_code_2e0eb9b26a2a4f9ca334c701ef2a7681-3"></a><span class="k">assert</span> <span class="n">transitivity</span> <span class="o">==</span> <span class="n">networkx</span><span class="o">.</span><span class="n">transitivity</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre>
<pre class="literal-block">
0.4090909090909091
</pre>
</div>
</div>
<div class="section" id="comparing-averaging-and-transitivity">
<h2>4 Comparing Averaging and Transitivity</h2>
<div class="section" id="one-high-degree-node">
<h3>4.1 One High Degree Node</h3>
<pre class="code ipython"><a name="rest_code_b47b47d136054d86932517e0cdfa86b4-1"></a><span class="n">high_lcc</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_b47b47d136054d86932517e0cdfa86b4-2"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"AABCCDEEFGGH"</span><span class="p">)</span>
<a name="rest_code_b47b47d136054d86932517e0cdfa86b4-3"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">"BIIDIIFIIHII"</span><span class="p">)</span>
<a name="rest_code_b47b47d136054d86932517e0cdfa86b4-4"></a><span class="n">high_lcc</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_b47b47d136054d86932517e0cdfa86b4-5"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw_spring</span><span class="p">(</span><span class="n">high_lcc</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="high_average.png" src="posts/triadic-closure/high_average.png"><p>If we look at this graph, the outer nodes all have a clustering coefficient of 1 (each has 1 pair of friends that are friends) while the center node has a coefficient of 1/7, since half the pairs don't have edges between them.</p>
<pre class="code ipython"><a name="rest_code_94f459e94af941e380157a732b81e2c8-1"></a><span class="n">degree_i</span> <span class="o">=</span> <span class="mi">8</span>
<a name="rest_code_94f459e94af941e380157a732b81e2c8-2"></a><span class="n">pairs_of_friends</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="rest_code_94f459e94af941e380157a732b81e2c8-3"></a><span class="n">pairs_that_are_friends</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="rest_code_94f459e94af941e380157a732b81e2c8-4"></a><span class="n">lcc</span> <span class="o">=</span> <span class="n">pairs_that_are_friends</span><span class="o">/</span><span class="n">pairs_of_friends</span>
<a name="rest_code_94f459e94af941e380157a732b81e2c8-5"></a><span class="k">print</span><span class="p">(</span><span class="n">lcc</span><span class="p">)</span>
</pre>
<pre class="literal-block">
1/7
</pre>
<p>Since there are so many nodes with a coefficient of 1, the average is high.</p>
<pre class="code ipython"><a name="rest_code_0d4758a181d14f4780e0eeefd7807757-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">average_clustering</span><span class="p">(</span><span class="n">high_lcc</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.9047619047619047
</pre>
<p>But there are many open triads so the transitivity will be low (transitivity weights nodes with large degree higher, but there's only one node with degree greater than 2).</p>
<pre class="code ipython"><a name="rest_code_2177fdf7e4934d66a791b10a16917588-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">transitivity</span><span class="p">(</span><span class="n">high_lcc</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.3333333333333333
</pre>
</div>
<div class="section" id="many-open-pairs">
<h3>4.2 Many Open Pairs</h3>
<pre class="code ipython"><a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-1"></a><span class="n">outer_left</span> <span class="o">=</span> <span class="s2">"ABDEGHJKMN"</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-2"></a><span class="n">inner_left</span> <span class="o">=</span> <span class="s2">"PPPPQQQRRS"</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-3"></a><span class="n">outer_right</span> <span class="o">=</span> <span class="s2">"BCEFHIKLNO"</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-4"></a><span class="n">inner_right</span> <span class="o">=</span> <span class="s2">"QRSTRSTSTT"</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-5"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outer_left</span> <span class="o">+</span> <span class="n">inner_left</span><span class="p">)</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-6"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outer_right</span> <span class="o">+</span> <span class="n">inner_right</span><span class="p">)</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-7"></a><span class="n">low_average</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-8"></a><span class="n">low_average</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_a36734f99bf4435b9a9b26b0155355e8-9"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">low_average</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="low_average.png" src="posts/triadic-closure/low_average.png"><p>Here the nodes P, Q, R, S, and T are completely connected (it's hard to see) but all the other nodes are open triads so the average will be low, but the transitivity will be high, because each of the P, Q, R, S, and T form triangles. This should be easier to see if they are plotted separately.</p>
<pre class="code ipython"><a name="rest_code_9ca754d18391420eb28134b4c87ee342-1"></a><span class="n">left</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inner_left</span><span class="p">)</span>
<a name="rest_code_9ca754d18391420eb28134b4c87ee342-2"></a><span class="n">right</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inner_right</span><span class="p">)</span>
<a name="rest_code_9ca754d18391420eb28134b4c87ee342-3"></a><span class="n">inner</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<a name="rest_code_9ca754d18391420eb28134b4c87ee342-4"></a><span class="n">inner</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)))</span>
<a name="rest_code_9ca754d18391420eb28134b4c87ee342-5"></a><span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<img alt="pqrst.png" src="posts/triadic-closure/pqrst.png"><p>Here's the average clustering coefficient (for the complete graph, not the sub-graph I just made).</p>
<pre class="code ipython"><a name="rest_code_b1b3ec09d6ba435b81f46b24e5bbaefc-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">average_clustering</span><span class="p">(</span><span class="n">low_average</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.25
</pre>
<p>And here's the transitivity.</p>
<pre class="code ipython"><a name="rest_code_e417093197b54d0996c161216171cf8a-1"></a><span class="k">print</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">transitivity</span><span class="p">(</span><span class="n">low_average</span><span class="p">))</span>
</pre>
<pre class="literal-block">
0.8571428571428571
</pre>
<p>So which one is the right metric? I guess it just depends.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/assignment-2-introduction-to-nltk/" class="u-url">Assignment 2 - Introduction to NLTK</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/assignment-2-introduction-to-nltk/" rel="bookmark"><time class="published dt-published" datetime="2017-08-12T15:02:00-07:00" title="2017-08-12 15:02">2017-08-12 15:02</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In part 1 of this assignment you will use nltk to explore the Herman Melville novel Moby Dick. Then in part 2 you will create a spelling recommender function that uses nltk to find words similar to the misspelling.</p>
<div class="section" id="part-1-analyzing-moby-dick">
<h2>1 Part 1 - Analyzing Moby Dick</h2>
<div class="section" id="imports-and-data-set-up">
<h3>1.1 Imports and Data Set Up</h3>
<pre class="code ipython"><a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-1"></a><span class="kn">from</span> <span class="nn">nltk.probability</span> <span class="kn">import</span> <span class="n">FreqDist</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-2"></a><span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-3"></a><span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">sent_tokenize</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-4"></a><span class="kn">import</span> <span class="nn">matplotlib</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-5"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-6"></a><span class="kn">import</span> <span class="nn">nltk</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-7"></a><span class="kn">import</span> <span class="nn">nltk.data</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-8"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-9"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-10"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-11"></a><span class="kn">import</span> <span class="nn">seaborn</span>
</pre>
<pre class="code ipython"><a name="rest_code_b7f4c0b43f974b02bdfb80251635251c-1"></a><span class="o">%</span><span class="k">matplotlib</span> inline
<a name="rest_code_b7f4c0b43f974b02bdfb80251635251c-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
<p>If you would like to work with the raw text you can use 'moby_raw'.</p>
<pre class="code ipython"><a name="rest_code_fc1bf0d0ba65473ab7bc1ddd4f303c5f-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'moby.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<a name="rest_code_fc1bf0d0ba65473ab7bc1ddd4f303c5f-2"></a>    <span class="n">moby_raw</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre>
<p>If you would like to work with the novel in <tt class="docutils literal">nltk.Text</tt> format you can use 'text1'.</p>
<pre class="code ipython"><a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-1"></a><span class="n">moby_tokens</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)</span>
<a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-2"></a><span class="n">text</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-3"></a><span class="n">moby_series</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="examples">
<h3>1.2 Examples</h3>
<div class="section" id="example-1">
<h4>1.2.1 Example 1</h4>
<p><em>How many tokens (words and punctuation symbols) are in text1?</em> A <strong>token</strong> is a linguistic unit such as a word, punctuation mark, or alpha-numeric strings.</p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_6aaee2f640b244a68694abafc51f151b-1"></a><span class="k">def</span> <span class="nf">example_one</span><span class="p">():</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-2"></a>     <span class="sd">"""counts the tokens in moby dick</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-3"></a>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-4"></a><span class="sd">     Returns:</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-5"></a><span class="sd">      int: number of tokens in moby dick</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-6"></a><span class="sd">     """</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-7"></a>     <span class="c1"># or alternatively len(text1)</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-8"></a>     <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-9"></a>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-10"></a><span class="n">MOBY_TOKEN_COUNT</span> <span class="o">=</span> <span class="n">example_one</span><span class="p">()</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} tokens."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-12"></a>     <span class="n">MOBY_TOKEN_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 254,989 tokens.
</pre>
</div>
<div class="section" id="example-2">
<h4>1.2.2 Example 2</h4>
<p><em>How many unique tokens (unique words and punctuation) does text1 have?</em></p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-1"></a><span class="k">def</span> <span class="nf">example_two</span><span class="p">():</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-2"></a>    <span class="sd">"""counts the unique tokens</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-3"></a>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-5"></a><span class="sd">     int: count of unique tokens in Moby Dick</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-6"></a><span class="sd">    """</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-7"></a>    <span class="c1"># or alternatively len(set(text1))</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)))</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-9"></a>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-10"></a><span class="n">MOBY_UNIQUE_COUNT</span> <span class="o">=</span> <span class="n">example_two</span><span class="p">()</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} unique tokens."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-12"></a>    <span class="n">MOBY_UNIQUE_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 20,755 unique tokens.
</pre>
</div>
<div class="section" id="example-3">
<h4>1.2.3 Example 3</h4>
<p><em>After lemmatizing the verbs, how many unique tokens does text1 have?</em> A <strong>lemma</strong> is the canonical form. e.g. <em>run</em> is the lemma for <em>runs</em>, <em>ran</em>, <em>running</em>, and <em>run</em>.</p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-1"></a><span class="k">def</span> <span class="nf">example_three</span><span class="p">():</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-2"></a>    <span class="sd">"""Counts the number of lemma in Moby Dick</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-3"></a>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-5"></a><span class="sd">     int: count of unique lemma</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-6"></a><span class="sd">    """</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-7"></a>    <span class="n">lemmatizer</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">lemmatizer</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s1">'v'</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">text1</span><span class="p">]))</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-9"></a>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-10"></a><span class="n">MOBY_LEMMA_COUNT</span> <span class="o">=</span> <span class="n">example_three</span><span class="p">()</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} lemma (found in WordNet)."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-12"></a>    <span class="n">MOBY_LEMMA_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 16,900 lemma (found in WordNet).
</pre>
</div>
</div>
<div class="section" id="questions">
<h3>1.3 Questions</h3>
<div class="section" id="question-1">
<h4>1.3.1 Question 1</h4>
<p>What is the lexical diversity of the given text input? (i.e. ratio of unique tokens to the total number of tokens)</p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_953cde7382604334989394a6f6e16c30-1"></a><span class="nd">@jit</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-2"></a><span class="k">def</span> <span class="nf">lexical_diversity</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-3"></a>    <span class="sd">"""Calculates the lexical diversity of a list of tokens</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-4"></a>
<a name="rest_code_953cde7382604334989394a6f6e16c30-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-6"></a><span class="sd">     float: fraction of tokens that are unique</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-7"></a><span class="sd">    """</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>
</pre>
<pre class="code ipython"><a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-1"></a><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-2"></a>    <span class="sd">"""Calculates the lexical diversity of Moby Dick</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-3"></a>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-5"></a><span class="sd">     float: fraction of tokens that are unique</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-6"></a><span class="sd">    """</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-7"></a>    <span class="k">return</span> <span class="n">lexical_diversity</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-8"></a>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-9"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-10"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Lexical Diversity of Moby Dick: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Lexical Diversity of Moby Dick: 0.08
</pre>
<p>About 8 percent of the tokens in Moby Dick are unique.</p>
</div>
<div class="section" id="question-2">
<h4>1.3.2 Question 2</h4>
<p><em>What percentage of tokens is 'whale'or 'Whale'?</em></p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_e61e89938fd14f8198d33a2144ecd3b0-1"></a><span class="n">moby_frequencies</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_91e336210b6b4631be5378580c2dd24e-1"></a><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-2"></a>    <span class="sd">"""calculates percentage of tokens that are 'whale'</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-3"></a>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-5"></a><span class="sd">     float: percentage of entries that are whales</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-6"></a><span class="sd">    """</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-7"></a>    <span class="n">whales</span> <span class="o">=</span> <span class="n">moby_frequencies</span><span class="p">[</span><span class="s2">"whale"</span><span class="p">]</span> <span class="o">+</span> <span class="n">moby_frequencies</span><span class="p">[</span><span class="s2">"Whale"</span><span class="p">]</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-8"></a>    <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">whales</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">MOBY_TOKEN_COUNT</span><span class="p">))</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-9"></a>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-10"></a><span class="n">whale_fraction</span> <span class="o">=</span> <span class="n">answer_two</span><span class="p">()</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Percentage of tokens that are whales: {:.2f} %"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whale_fraction</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Percentage of tokens that are whales: 0.41 %
</pre>
<p>Around 1 percent of the tokens are 'whale'.</p>
<p>I originally made two mistakes with this question, I was returning a fraction, not a percentage, and I was using a regular expression <em>'([Ww]hale)'</em> which I later realized would match <em>whales</em>, <em>whaler</em>, and other variants.</p>
<pre class="literal-block">
782
</pre>
</div>
<div class="section" id="question-3">
<h4>1.3.3 Question 3</h4>
<p><em>What are the 20 most frequently occurring (unique) tokens in the text? What is their frequency?</em></p>
<p><strong>This function should return a list of 20 tuples where each tuple is of the form `(token, frequency)`. The list should be sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_8df9215976e04d879757587fccbb2313-1"></a><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-2"></a>    <span class="sd">"""finds 20 most requently occuring tokens</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-3"></a>
<a name="rest_code_8df9215976e04d879757587fccbb2313-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-5"></a><span class="sd">     list: (token, frequency) for top 20 tokens</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-6"></a><span class="sd">    """</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-7"></a>    <span class="k">return</span> <span class="n">moby_frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-8"></a>
<a name="rest_code_8df9215976e04d879757587fccbb2313-9"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_three</span><span class="p">())</span>
</pre>
<pre class="literal-block">
[(',', 19204), ('the', 13715), ('.', 7308), ('of', 6513), ('and', 6010), ('a', 4545), ('to', 4515), (';', 4173), ('in', 3908), ('that', 2978), ('his', 2459), ('it', 2196), ('I', 2097), ('!', 1767), ('is', 1722), ('--', 1713), ('with', 1659), ('he', 1658), ('was', 1639), ('as', 1620)]
</pre>
</div>
<div class="section" id="question-4">
<h4>1.3.4 Question 4</h4>
<p><em>What tokens have a length of greater than 5 and frequency of more than 150?</em></p>
<p><strong>This function should return a sorted list of the tokens that match the above constraints. To sort your list, use `sorted()`</strong></p>
<pre class="code ipython"><a name="rest_code_98a78f817e9c414fa18cc8d2a116db65-1"></a><span class="n">moby_frequency_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">moby_frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(),</span>
<a name="rest_code_98a78f817e9c414fa18cc8d2a116db65-2"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"token"</span><span class="p">,</span> <span class="s2">"frequency"</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_338a2db467c341a2bc74d8e2ae540352-1"></a><span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-2"></a>    <span class="sd">"""gets tokens with length &gt; 5, frequency &gt; 150"""</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-3"></a>    <span class="n">frame</span> <span class="o">=</span>  <span class="n">moby_frequency_frame</span><span class="p">[(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">)</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-4"></a>                                  <span class="o">&amp;</span> <span class="p">(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)]</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-5"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-6"></a>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-7"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-8"></a><span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre>
<pre class="literal-block">
['Captain', 'Pequod', 'Queequeg', 'Starbuck', 'almost', 'before', 'himself', 'little', 'seemed', 'should', 'though', 'through', 'whales', 'without']
</pre>
<p>I was originally returning the data frame, not just the sorted tokens, which was of course marked wrong.</p>
</div>
<div class="section" id="question-5">
<h4>1.3.5 Question 5</h4>
<p><em>Find the longest word in text1 and that word's length.</em></p>
<p><strong>This function should return a tuple `(longest_word, length)`.</strong></p>
<pre class="code ipython"><a name="rest_code_d017350420344667a85421aa61dbbafd-1"></a><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-2"></a>    <span class="sd">"""finds the longest word and its length</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-3"></a>
<a name="rest_code_d017350420344667a85421aa61dbbafd-4"></a><span class="sd">    Return:</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-5"></a><span class="sd">     tuple: (longest-word, length)</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-6"></a><span class="sd">    """</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-7"></a>    <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">())</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-8"></a>    <span class="n">longest</span> <span class="o">=</span> <span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s2">"(?P&lt;long&gt;.{{{}}})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-9"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">longest</span><span class="o">.</span><span class="n">long</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">)</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-10"></a>
<a name="rest_code_d017350420344667a85421aa61dbbafd-11"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_five</span><span class="p">())</span>
</pre>
<pre class="literal-block">
("twelve-o'clock-at-night", 23)
</pre>
</div>
<div class="section" id="question-6">
<h4>1.3.6 Question 6</h4>
<p><em>What unique words have a frequency of more than 2000? What is their frequency?</em></p>
<p>Hint:  you may want to use `isalpha()` to check if the token is a word and not punctuation.</p>
<p><strong>This function should return a list of tuples of the form `(frequency, word)` sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_38a29af671314fada3d66cc440160e84-1"></a><span class="n">moby_words</span> <span class="o">=</span> <span class="n">moby_frequency_frame</span><span class="p">[</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()]</span>
</pre>
<pre class="code ipython"><a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-1"></a><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-2"></a>    <span class="sd">"""Finds words wih frequency &gt; 2000</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-3"></a>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-5"></a><span class="sd">     list: frequency, word tuples</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-6"></a><span class="sd">    """</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-7"></a>    <span class="n">common</span> <span class="o">=</span> <span class="n">moby_words</span><span class="p">[</span><span class="n">moby_words</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">]</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-8"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">token</span><span class="p">))</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-9"></a>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-10"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_six</span><span class="p">())</span>
</pre>
<pre class="literal-block">
[(13715, 'the'), (6513, 'of'), (6010, 'and'), (4545, 'a'), (4515, 'to'), (3908, 'in'), (2978, 'that'), (2459, 'his'), (2196, 'it'), (2097, 'I')]
</pre>
<p>When I first submitted this I got it wrong because I was returning a list of <tt class="docutils literal">(word, frequency)</tt>, not <tt class="docutils literal">(frequency, word)</tt>.</p>
</div>
<div class="section" id="question-7">
<h4>1.3.7 Question 7</h4>
<p><em>What is the average number of tokens per sentence?</em></p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-1"></a><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-2"></a>    <span class="sd">"""average number of tokens per sentence"""</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-3"></a>    <span class="n">sentences</span> <span class="o">=</span> <span class="n">sent_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-4"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">))</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">)</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-5"></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-6"></a>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-7"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_seven</span><span class="p">()</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-8"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Average number of tokens per sentence: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Average number of tokens per sentence: 25.88
</pre>
</div>
<div class="section" id="question-8">
<h4>1.3.8 Question 8</h4>
<p><em>What are the 5 most frequent parts of speech in this text? What is their frequency?</em> Parts of Speech (POS) are the lexical categories that words belong to.</p>
<p><strong>This function should return a list of tuples of the form `(part_of_speech, frequency)` sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_19f22d7ad474405481d7131903d135b8-1"></a><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-2"></a>    <span class="sd">"""gets the 5 most frequent parts of speech</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-3"></a>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-5"></a><span class="sd">     list (Tuple): (part of speech, frequency) for top 5</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-6"></a><span class="sd">    """</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-7"></a>    <span class="n">tags</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">moby_words</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-8"></a>    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">([</span><span class="n">tag</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-9"></a>    <span class="k">return</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-10"></a>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-11"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_eight</span><span class="p">()</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-12"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Top 5 parts of speech: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Top 5 parts of speech: [('NN', 4016), ('NNP', 2916), ('JJ', 2875), ('NNS', 2452), ('VBD', 1421)]
</pre>
</div>
</div>
</div>
<div class="section" id="part-2-spelling-recommender">
<h2>2 Part 2 - Spelling Recommender</h2>
<p>For this part of the assignment you will create three different spelling recommenders, that each take a list of misspelled words and recommends a correctly spelled word for every word in the list.</p>
<p>For every misspelled word, the recommender should find find the word in `correct_spellings` that has the shortest distance*, and starts with the same letter as the misspelled word, and return that word as a recommendation.</p>
<p><strong>Each of the three different recommenders will use a different distance measure (outlined below)</strong>.</p>
<p>Each of the recommenders should provide recommendations for the three default words provided: `['cormulent', 'incendenece', 'validrate']`.</p>
<pre class="code ipython"><a name="rest_code_c372ab263f1d45578d94796201db0be8-1"></a><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">words</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-2"></a><span class="kn">from</span> <span class="nn">nltk.metrics.distance</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-3"></a>    <span class="n">edit_distance</span><span class="p">,</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-4"></a>    <span class="n">jaccard_distance</span><span class="p">,</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-5"></a>    <span class="p">)</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-6"></a><span class="kn">from</span> <span class="nn">nltk.util</span> <span class="kn">import</span> <span class="n">ngrams</span>
</pre>
<pre class="code ipython"><a name="rest_code_fa927e815f8b40d89b5f7e83114acda8-1"></a><span class="n">correct_spellings</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">words</span><span class="p">()</span>
<a name="rest_code_fa927e815f8b40d89b5f7e83114acda8-2"></a><span class="n">spellings_series</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">correct_spellings</span><span class="p">)</span>
</pre>
<div class="section" id="question-9">
<h3>2.1 Question 9</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a> on the trigrams of the two words.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_5803e6005d404a1387f7c85c7a047379-1"></a><span class="k">def</span> <span class="nf">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">):</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-2"></a>    <span class="sd">"""find the closet words to each entry</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-3"></a>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-4"></a><span class="sd">    Args:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-5"></a><span class="sd">     entries: collection of words to match</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-6"></a><span class="sd">     gram_number: number of n-grams to use</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-7"></a>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-9"></a><span class="sd">     list: words with the closest jaccard distance to entries</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-10"></a><span class="sd">    """</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-11"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-12"></a>    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-13"></a>        <span class="n">spellings</span> <span class="o">=</span> <span class="n">spellings_series</span><span class="p">[</span><span class="n">spellings_series</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-14"></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">((</span><span class="n">jaccard_distance</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">)),</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-15"></a>                                       <span class="nb">set</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">))),</span> <span class="n">word</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-16"></a>                     <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">spellings</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-17"></a>        <span class="n">closest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-18"></a>        <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-19"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_51620bbdded141b59e1f6155d4f972af-1"></a><span class="k">def</span> <span class="nf">answer_nine</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-2"></a>    <span class="sd">"""finds the closest word based on jaccard distance"""</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-3"></a>    <span class="k">return</span> <span class="n">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-4"></a>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-5"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_nine</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['corpulent', 'indecence', 'validate']
</pre>
<p>I originally got both the Jaccard Distance problems wrong because I was just using the distance, not filtering the candidates by the first letter, which turns out to return fairly dissimilar words.</p>
</div>
<div class="section" id="question-10">
<h3>2.2 Question 10</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a> on the 4-grams of the two words.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-1"></a><span class="k">def</span> <span class="nf">answer_ten</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-2"></a>    <span class="sd">"""gets the neares words using jaccard-distance with 4-grams</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-3"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-4"></a><span class="sd">    Args:</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-5"></a><span class="sd">     entries (list): words to find nearest other word for</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-6"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-8"></a><span class="sd">     list: nearest words found</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-9"></a><span class="sd">    """</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-10"></a>    <span class="k">return</span> <span class="n">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-11"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-12"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_ten</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['cormus', 'incendiary', 'valid']
</pre>
</div>
<div class="section" id="question-11">
<h3>2.3 Question 11</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">Edit (Levenshtein) distance</a> on the two words with transpositions.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-1"></a><span class="k">def</span> <span class="nf">answer_eleven</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-2"></a>    <span class="sd">"""gets the nearest words based on Levenshtein distance</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-3"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-4"></a><span class="sd">    Args:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-5"></a><span class="sd">     entries (list[str]): words to find closest words to</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-6"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-8"></a><span class="sd">     list[str]: nearest words to the entries</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-9"></a><span class="sd">    """</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-10"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-11"></a>    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-12"></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">((</span><span class="n">edit_distance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-13"></a>                                    <span class="n">word</span><span class="p">),</span> <span class="n">word</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-14"></a>                     <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">correct_spellings</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-15"></a>        <span class="n">closest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-16"></a>        <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-17"></a>    <span class="k">return</span> <span class="n">outcomes</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-18"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-19"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_eleven</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['corpulent', 'intendence', 'validate']
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/extracting-dates-from-medical-data/" class="u-url">Extracting Dates From Medical Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/extracting-dates-from-medical-data/" rel="bookmark"><time class="published dt-published" datetime="2017-08-07T17:16:00-07:00" title="2017-08-07 17:16">2017-08-07 17:16</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>In this assignment, you'll be working with messy medical data and using regular expressions to extract relevant information from the data.</p>
<p>Each line of the <tt class="docutils literal">dates.txt</tt> file corresponds to a medical note. Each note has a date that needs to be extracted, but each date is encoded in one of many formats.</p>
<p>The goal of this assignment is to correctly identify all of the different date variants encoded in this dataset and to properly normalize and sort the dates.</p>
<p>Here is a list of some of the variants you might encounter in this dataset:</p>
<ul class="simple">
<li>04/20/2009; 04/20/09; 4/20/09; 4/3/09</li>
<li>Mar-20-2009; Mar 20, 2009; March 20, 2009;  Mar. 20, 2009; Mar 20 2009;</li>
<li>20 Mar 2009; 20 March 2009; 20 Mar. 2009; 20 March, 2009</li>
<li>Mar 20th, 2009; Mar 21st, 2009; Mar 22nd, 2009</li>
<li>Feb 2009; Sep 2009; Oct 2010</li>
<li>6/2008; 12/2009</li>
<li>2009; 2010</li>
</ul>
<p>Once you have extracted these date patterns from the text, the next step is to sort them in ascending chronological order accoring to the following rules:</p>
<ul class="simple">
<li>Assume all dates in xx/xx/xx format are mm/dd/yy</li>
<li>Assume all dates where year is encoded in only two digits are years from the 1900's (e.g. 1/5/89 is January 5th, 1989)</li>
<li>If the day is missing (e.g. 9/2009), assume it is the first day of the month (e.g. September 1, 2009).</li>
<li>If the month is missing (e.g. 2010), assume it is the first of January of that year (e.g. January 1, 2010).</li>
</ul>
<p>With these rules in mind, find the correct date in each note and return a pandas Series in chronological order of the original Series' indices.</p>
<p>For example if the original series was this:</p>
<pre class="literal-block">
0    1999
1    2010
2    1978
3    2015
4    1985
</pre>
<pre class="literal-block">
0    2
1    4
2    0
3    1
4    3
</pre>
<p>Your score will be calculated using <a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">Kendall's tau</a>, a correlation measure for ordinal data.</p>
<p><strong>This function should return a Series of length 500 and dtype int.</strong></p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code ipython"><a name="rest_code_9b631790537144579c83f03f88990bad-1"></a><span class="c1"># from pypi</span>
<a name="rest_code_9b631790537144579c83f03f88990bad-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
</pre>
</div>
<div class="section" id="loading-the-data">
<h2>3 Loading The Data</h2>
<pre class="code ipython"><a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'dates.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-2"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-3"></a>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-4"></a><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre>
<pre class="literal-block">
0         03/25/93 Total time of visit (in minutes):\n
1                       6/18/85 Primary Care Doctor:\n
2    sshe plans to move as of 7/8/71 In-Home Servic...
3                7 on 9/27/75 Audit C Score Current:\n
4    2/6/96 sleep studyPain Treatment Pain Level (N...
5                    .Per 7/06/79 Movement D/O note:\n
6    4, 5/18/78 Patient's thoughts about current su...
7    10/24/89 CPT Code: 90801 - Psychiatric Diagnos...
8                         3/7/86 SOS-10 Total Score:\n
9             (4/10/71)Score-1Audit C Score Current:\n
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_57ded1fdca904a5988df20f362cd4ec4-1"></a><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre>
<pre class="literal-block">
count                                                   500
unique                                                  500
top       sApproximately 7 psychiatric hospitalizations ...
freq                                                      1
dtype: object
</pre>
</div>
<div class="section" id="the-grammar">
<h2>4 The Grammar</h2>
<div class="section" id="cardinality">
<h3>4.1 Cardinality</h3>
<pre class="code ipython"><a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-1"></a><span class="n">ZERO_OR_MORE</span> <span class="o">=</span> <span class="s1">'*'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-2"></a><span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="s2">"+"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-3"></a><span class="n">ZERO_OR_ONE</span> <span class="o">=</span> <span class="s1">'?'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-4"></a><span class="n">EXACTLY_TWO</span> <span class="o">=</span> <span class="s2">"{2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-5"></a><span class="n">ONE_OR_TWO</span> <span class="o">=</span> <span class="s2">"{1,2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-6"></a><span class="n">EXACTLY_ONE</span> <span class="o">=</span> <span class="s1">'{1}'</span>
</pre>
</div>
<div class="section" id="groups-and-classes">
<h3>4.2 Groups and Classes</h3>
<pre class="code ipython"><a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-1"></a><span class="n">GROUP</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"({})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-2"></a><span class="n">NAMED</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"(?P&lt;{}&gt;{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-3"></a><span class="n">CLASS</span> <span class="o">=</span> <span class="s2">"[{}]"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-4"></a><span class="n">NEGATIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-5"></a><span class="n">NEGATIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-6"></a><span class="n">POSITIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-7"></a><span class="n">POSITIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-8"></a><span class="n">ESCAPE</span> <span class="o">=</span> <span class="s2">"\{}"</span>
</pre>
</div>
<div class="section" id="numbers">
<h3>4.3 Numbers</h3>
<pre class="code ipython"><a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-1"></a><span class="n">DIGIT</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\d"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-2"></a><span class="n">ONE_DIGIT</span>  <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_ONE</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-3"></a><span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-4"></a><span class="n">NON_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span><span class="p">)</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-5"></a><span class="n">TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-6"></a><span class="n">THREE_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="s2">"{3}"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-7"></a><span class="n">EXACTLY_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-8"></a><span class="n">FOUR_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">"{4}"</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
</pre>
</div>
<div class="section" id="string-literals">
<h3>4.4 String Literals</h3>
<pre class="code ipython"><a name="rest_code_8d32b18c02d04df28379534a1c7949b0-1"></a><span class="n">SLASH</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"/"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-2"></a><span class="n">OR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'|'</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-3"></a><span class="n">LOWER_CASE</span> <span class="o">=</span> <span class="s2">"a-z"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-4"></a><span class="n">SPACE</span> <span class="o">=</span> <span class="s2">"\s"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-5"></a><span class="n">DOT</span> <span class="o">=</span> <span class="s2">"."</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-6"></a><span class="n">DASH</span> <span class="o">=</span> <span class="s2">"-"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-7"></a><span class="n">COMMA</span> <span class="o">=</span> <span class="s2">","</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-8"></a><span class="n">PUNCTUATION</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-9"></a><span class="n">EMPTY_STRING</span> <span class="o">=</span> <span class="s2">""</span>
</pre>
</div>
<div class="section" id="dates">
<h3>4.5 Dates</h3>
<p>These are parts to build up the date-expressions.</p>
<pre class="code ipython"><a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-1"></a><span class="n">MONTH_SUFFIX</span> <span class="o">=</span> <span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-2"></a>                <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SPACE</span> <span class="o">+</span> <span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span><span class="p">)</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-3"></a><span class="n">MONTH_PREFIXES</span> <span class="o">=</span> <span class="s2">"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-4"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">month</span> <span class="o">+</span> <span class="n">MONTH_SUFFIX</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_PREFIXES</span><span class="p">]</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-5"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MONTHS</span><span class="p">))</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-6"></a><span class="n">DAY_SUFFIX</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DASH</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-7"></a><span class="n">DAYS</span> <span class="o">=</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-8"></a><span class="n">YEAR</span> <span class="o">=</span> <span class="n">FOUR_DIGITS</span>
</pre>
<p>This is for dates like <em>Mar 21st, 2009</em>, those with suffixes on the days.</p>
<pre class="code ipython"><a name="rest_code_64197d882bd04964b03a78b818a7439e-1"></a><span class="n">CONTRACTED</span> <span class="o">=</span> <span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-2"></a>              <span class="o">+</span> <span class="n">LOWER_CASE</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-3"></a>              <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-4"></a>              <span class="p">)</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-5"></a><span class="n">CONTRACTION</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"contraction"</span><span class="p">,</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-6"></a>                           <span class="n">MONTHS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-7"></a>                           <span class="o">+</span> <span class="n">CONTRACTED</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-8"></a>                           <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-9"></a>                           <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for dates that have no days in them, like <em>May 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_88d6900b06dd48868e9b47e314a3552e-1"></a><span class="n">NO_DAY_BEHIND</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span>
<a name="rest_code_88d6900b06dd48868e9b47e314a3552e-2"></a><span class="n">NO_DAY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day"</span><span class="p">,</span> <span class="n">NO_DAY_BEHIND</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the most common form (that I use) - <em>May 21, 2017</em>.</p>
<pre class="code ipython"><a name="rest_code_87c43c521ca64721be5846e6e2899c17-1"></a><span class="n">WORDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"words"</span><span class="p">,</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">DAYS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the case where the day is placed before them month - <em>20 March, 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_64130b76c99e449d968c5cffe7f9c8e1-1"></a><span class="n">BACKWARDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"backwards"</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is the case where slashes are used but only two digits were used for the year (so we're assuming it's in the twentieth century) - <em>8/4/98</em>.</p>
<pre class="code ipython"><a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-1"></a><span class="n">slashed</span> <span class="o">=</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-2"></a>                      <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-3"></a>                      <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-4"></a><span class="n">dashed</span> <span class="o">=</span> <span class="n">DASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-5"></a>                    <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-6"></a>                    <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-7"></a><span class="n">TWENTIETH_CENTURY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"twentieth"</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-8"></a>                                 <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">slashed</span><span class="p">,</span> <span class="n">dashed</span><span class="p">]))</span>
</pre>
<p>This is the case where digits with slashes are used and all four digits are used for the year - <em>8/4/1998</em>.</p>
<pre class="code ipython"><a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-1"></a><span class="n">NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-2"></a>                       <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-3"></a>                                   <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-4"></a>                                   <span class="n">FOUR_DIGITS</span><span class="p">]))</span>
</pre>
<p>This is the case where only month and year are given as digits - <em>9/2009</em>. There are two expressions, because the day can be one or two digits.</p>
<pre class="code ipython"><a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-1"></a><span class="n">NO_PRECEDING_SLASH</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-2"></a><span class="n">NO_PRECEDING_SLASH_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span> <span class="o">+</span> <span class="n">DIGIT</span><span class="p">))</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-3"></a><span class="n">NO_ONE_DAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-4"></a>              <span class="o">+</span> <span class="n">ONE_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-5"></a>              <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-6"></a>              <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-7"></a><span class="n">NO_TWO_DAYS</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-8"></a>               <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-9"></a>               <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-10"></a>               <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-11"></a><span class="n">NO_DAY_NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day_numeric"</span><span class="p">,</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-12"></a>                              <span class="n">NO_ONE_DAY</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-13"></a>                              <span class="o">+</span> <span class="n">OR</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-14"></a>                              <span class="o">+</span> <span class="n">NO_TWO_DAYS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-15"></a>                              <span class="p">)</span>
</pre>
<p>This is the case where only a year was given. This is the hardest case, since you don't want to accidentally match the other cases, but the text preceding and following it could be anything. For the look-behind, all the cases have to have the same number of characters so we can't re-use the other expressions</p>
<pre class="code ipython"><a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-1"></a><span class="n">CENTURY</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'19'</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="s2">"20"</span><span class="p">)</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-2"></a><span class="n">DIGIT_SLASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-3"></a><span class="n">DIGIT_DASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">DASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-4"></a><span class="n">DIGIT_SPACE</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-5"></a><span class="n">LETTER_SPACE</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-6"></a><span class="n">COMMA_SPACE</span> <span class="o">=</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-7"></a><span class="n">YEAR_PREFIX</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-8"></a>    <span class="n">DIGIT_SLASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-9"></a>    <span class="n">DIGIT_DASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-10"></a>    <span class="n">DIGIT_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-11"></a>    <span class="n">LETTER_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-12"></a>    <span class="n">COMMA_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-13"></a><span class="p">]))</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-14"></a>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-15"></a><span class="n">YEAR_ONLY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"year_only"</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-16"></a>                         <span class="n">YEAR_PREFIX</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-17"></a><span class="p">)</span>
</pre>
<p>These are leftovers that don't really match anything.</p>
<pre class="code ipython"><a name="rest_code_2255d8380ad6401cbe389a36a364eaff-1"></a><span class="n">IN_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'iI'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'n'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-2"></a><span class="n">SINCE_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Ss"</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'ince'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-3"></a><span class="n">AGE</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-4"></a><span class="n">AGE_COMMA</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-5"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'delivery'</span><span class="p">,</span> <span class="s2">"quit"</span><span class="p">,</span> <span class="s2">"attempt"</span><span class="p">,</span> <span class="s2">"nephrectomy"</span><span class="p">,</span> <span class="n">THREE_DIGITS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-6"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">OTHERS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-7"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OTHERS</span><span class="p">)</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-8"></a><span class="n">LEFTOVERS_PREFIX</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">IN_PREFIX</span><span class="p">,</span> <span class="n">SINCE_PREFIX</span><span class="p">,</span> <span class="n">AGE</span><span class="p">,</span> <span class="n">AGE_COMMA</span><span class="p">])</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="n">OTHERS</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-9"></a><span class="n">LEFTOVERS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"leftovers"</span><span class="p">,</span> <span class="n">LEFTOVERS_PREFIX</span><span class="p">)</span>
</pre>
<p>This is the combined expression for all the dates - the one that should be used to extract them from the data.</p>
<pre class="code ipython"><a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-1"></a><span class="n">DATE</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-2"></a>                                     <span class="n">TWENTIETH_CENTURY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-3"></a>                                     <span class="n">WORDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-4"></a>                                     <span class="n">BACKWARDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-5"></a>                                     <span class="n">CONTRACTION</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-6"></a>                                     <span class="n">NO_DAY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-7"></a>                                     <span class="n">NO_DAY_NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-8"></a>                                     <span class="n">YEAR_ONLY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-9"></a>                                     <span class="n">LEFTOVERS</span><span class="p">]))</span>
</pre>
<pre class="code ipython"><a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-1"></a><span class="k">def</span> <span class="nf">twentieth_century</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-2"></a>    <span class="sd">"""adds a 19 to the year</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-3"></a>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-5"></a><span class="sd">     date (re.Regex): Extracted date</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-6"></a><span class="sd">    """</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-7"></a>    <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-8"></a>    <span class="n">year</span> <span class="o">=</span> <span class="s2">"19{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-9"></a>    <span class="k">return</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_6de3e020d2fb476caba774a582541806-1"></a><span class="k">def</span> <span class="nf">take_two</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-2"></a>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-3"></a>    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-4"></a>        <span class="k">return</span> <span class="n">twentieth_century</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-5"></a>    <span class="k">return</span> <span class="n">line</span>
</pre>
</div>
</div>
<div class="section" id="applying-the-grammer">
<h2>5 Applying The Grammer</h2>
<pre class="code ipython"><a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-1"></a><span class="k">def</span> <span class="nf">extract_and_count</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-2"></a>    <span class="sd">"""extract all matches and report the count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-3"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-5"></a><span class="sd">     expression (str): regular expression to match</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-6"></a><span class="sd">     data (pandas.Series): data with dates to extratc</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-7"></a><span class="sd">     name (str): name of the group for the expression</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-8"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-10"></a><span class="sd">     tuple (pandas.Series, int): extracted dates, count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-11"></a><span class="sd">    """</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-12"></a>    <span class="n">extracted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">expression</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-13"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-14"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"'{}' matched {} rows"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-15"></a>    <span class="k">return</span> <span class="n">extracted</span><span class="p">,</span> <span class="n">count</span>
</pre>
<pre class="code ipython"><a name="rest_code_63aead1280094848a5ebbfe01e78cccf-1"></a><span class="n">numeric</span><span class="p">,</span> <span class="n">numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'numeric' matched 25 rows
</pre>
<pre class="code ipython"><a name="rest_code_97322d2aec224ba7bbb9f48697b64d0b-1"></a><span class="n">twentieth</span><span class="p">,</span> <span class="n">twentieth_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'twentieth'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'twentieth' matched 100 rows
</pre>
<pre class="code ipython"><a name="rest_code_ca85b3c6e1c44f678fd7d3101ed02935-1"></a><span class="n">words</span><span class="p">,</span> <span class="n">words_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">WORDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'words'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'words' matched 34 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c14eab4f1ab4f7d9914e4dc1d3aaac6-1"></a><span class="n">backwards</span><span class="p">,</span> <span class="n">backwards_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">BACKWARDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'backwards'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'backwards' matched 69 rows
</pre>
<pre class="code ipython"><a name="rest_code_a146a4d183cf48039637b7d71611679a-1"></a><span class="n">contraction_data</span><span class="p">,</span> <span class="n">contraction</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">CONTRACTION</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'contraction'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'contraction' matched 0 rows
</pre>
<pre class="code ipython"><a name="rest_code_a72ab48d948d46be864df3b547f2b1d3-1"></a><span class="n">no_day</span><span class="p">,</span> <span class="n">no_day_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'no_day'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day' matched 115 rows
</pre>
<pre class="code ipython"><a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-1"></a><span class="n">no_day_numeric</span><span class="p">,</span> <span class="n">no_day_numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY_NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-2"></a>                                                         <span class="s2">"no_day_numeric"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day_numeric' matched 112 rows
</pre>
<pre class="code ipython"><a name="rest_code_328d16933ace4fb6b298976941bd57a9-1"></a><span class="n">year_only</span><span class="p">,</span> <span class="n">year_only_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"year_only"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'year_only' matched 15 rows
</pre>
<pre class="code ipython"><a name="rest_code_eb1ef7f0d59e496d942d099e9ca6aeda-1"></a><span class="n">leftovers</span><span class="p">,</span> <span class="n">leftovers_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">LEFTOVERS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"leftovers"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'leftovers' matched 30 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c2079d77eec447ea7842e050ebb187c-1"></a><span class="n">found</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DATE</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-2"></a><span class="n">total_found</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-3"></a>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-4"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Total Found: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-5"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Remaining: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-6"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Discrepancy: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span> <span class="o">-</span> <span class="p">(</span><span class="n">numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-7"></a>                                              <span class="o">+</span> <span class="n">twentieth_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-8"></a>                                              <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-9"></a>                                              <span class="o">+</span> <span class="n">backwards_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-10"></a>                                              <span class="o">+</span> <span class="n">contraction</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-11"></a>                                              <span class="o">+</span> <span class="n">no_day_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-12"></a>                                              <span class="o">+</span> <span class="n">no_day_numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-13"></a>                                              <span class="o">+</span> <span class="n">year_only_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-14"></a>                                              <span class="o">+</span> <span class="n">leftovers_count</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
Total Found: 500
Remaining: 0
Discrepancy: 0
</pre>
<pre class="code ipython"><a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-1"></a><span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-2"></a><span class="k">try</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-3"></a>    <span class="k">print</span><span class="p">(</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-4"></a><span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-5"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"all rows matched"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
all rows matched
</pre>
</div>
<div class="section" id="unifying-the-formats">
<h2>6 Unifying the Formats</h2>
<p>To make it simpler, I'm going to use the <tt class="docutils literal">mm/dd/yyyy</tt> format for the dates. I'm going to use the extracted series to avoid having different clean-up cases contaminating each other - e.g. dealing with 'January' when the day comes first as opposed to when the month comes first.</p>
<div class="section" id="helper-functions">
<h3>6.1 Helper Functions</h3>
<div class="section" id="clean">
<h4>6.1.1 Clean</h4>
<p>This is a generic function to clean up some data. I was initially using it directly, but for cases where the expression and replacement function are used more than once, there are helper functions to make it easier.</p>
<pre class="code ipython"><a name="rest_code_26a70e05d01c41cc987bece031f5383d-1"></a><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-2"></a>    <span class="sd">"""applies the replacement to the source</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-3"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-4"></a><span class="sd">    as a side-effect shows sample rows before and after</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-5"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-6"></a><span class="sd">    Args:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-7"></a><span class="sd">     source (pandas.Series): source of the strings</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-8"></a><span class="sd">     expression (str): regular expression to match what to replace</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-9"></a><span class="sd">     replacement: function or expression to replace the matching expression</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-10"></a><span class="sd">     sample (int): number of randomly chosen examples to show</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-11"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-12"></a><span class="sd">    Returns:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-13"></a><span class="sd">     pandas.Series: the source with the replacement applied to it</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-14"></a><span class="sd">    """</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Random Sample Before:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-16"></a>    <span class="k">print</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-17"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-18"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Sample After:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-19"></a>    <span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-20"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Count of cleaned: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-21"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-22"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="clean-punctuation">
<h4>6.1.2 Clean Punctuation</h4>
<pre class="code ipython"><a name="rest_code_a48cfea51ef94f539affe06202de9df7-1"></a><span class="k">def</span> <span class="nf">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-2"></a>    <span class="sd">"""removes punctuation</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-3"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-4"></a><span class="sd">    Args:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-5"></a><span class="sd">     source (pandas.Series): data to clean</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-7"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-9"></a><span class="sd">     pandas.Series: source with punctuation removed</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-10"></a><span class="sd">    """</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-11"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Cleaning Punctuation"</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-12"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">PUNCTUATION</span><span class="p">)):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-13"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">PUNCTUATION</span><span class="p">,</span> <span class="n">EMPTY_STRING</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-14"></a>    <span class="k">return</span> <span class="n">source</span>
</pre>
</div>
<div class="section" id="convert-long-month-names-to-three-letter-names">
<h4>6.1.3 Convert Long Month Names to Three-Letter Names</h4>
<pre class="code ipython"><a name="rest_code_4682e078636b4cfc87b46112d727633b-1"></a><span class="n">LONG_TO_SHORT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">January</span><span class="o">=</span><span class="s2">"Jan"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-2"></a>                     <span class="n">February</span><span class="o">=</span><span class="s2">"Feb"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-3"></a>                     <span class="n">March</span><span class="o">=</span><span class="s2">"Mar"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-4"></a>                     <span class="n">April</span><span class="o">=</span><span class="s2">"Apr"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-5"></a>                     <span class="n">May</span><span class="o">=</span><span class="s2">"May"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-6"></a>                     <span class="n">June</span><span class="o">=</span><span class="s2">"Jun"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-7"></a>                     <span class="n">July</span><span class="o">=</span><span class="s2">"Jul"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-8"></a>                     <span class="n">August</span><span class="o">=</span><span class="s2">"Aug"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-9"></a>                     <span class="n">September</span><span class="o">=</span><span class="s2">"Sep"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-10"></a>                     <span class="n">October</span><span class="o">=</span><span class="s2">"Oct"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-11"></a>                     <span class="n">November</span><span class="o">=</span><span class="s2">"Nov"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-12"></a>                     <span class="n">December</span><span class="o">=</span><span class="s2">"Dec"</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-13"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-14"></a><span class="c1"># it turns out there are spelling errors in the data so this has to be fuzzy</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-15"></a><span class="n">LONG_TO_SHORT_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-16"></a>                                    <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-17"></a>                                    <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-18"></a>                                    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">LONG_TO_SHORT</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-19"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-20"></a><span class="k">def</span> <span class="nf">long_month_to_short</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-21"></a>    <span class="sd">"""convert long month to short</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-22"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-23"></a><span class="sd">    Args:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-24"></a><span class="sd">     match (re.Match): object matching a long month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-25"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-26"></a><span class="sd">    Returns:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-27"></a><span class="sd">     str: shortened version of the month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-28"></a><span class="sd">    """</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-29"></a>    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastindex</span><span class="p">)</span>
</pre>
<p>This next function is the one you would actually use to make the conversion.</p>
<pre class="code ipython"><a name="rest_code_33736a1f662e47018e28cba7502b4452-1"></a><span class="k">def</span> <span class="nf">convert_long_months_to_short</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-2"></a>    <span class="sd">"""convert long month names to short</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-3"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-4"></a><span class="sd">    Args:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-5"></a><span class="sd">     source (pandas.Series): data with months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-7"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-9"></a><span class="sd">     pandas.Series: data with short months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-10"></a><span class="sd">    """</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-12"></a>                 <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-13"></a>                 <span class="n">long_month_to_short</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="add-january-1-to-year-only-dates">
<h4>6.1.4 Add January 1 to year-only dates</h4>
<pre class="code ipython"><a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-1"></a><span class="k">def</span> <span class="nf">add_month_date</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-2"></a>    <span class="sd">"""adds 01/01 to years</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-3"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-4"></a><span class="sd">    Args:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-5"></a><span class="sd">     match (re.Match): object that only matched a 4-digit year</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-6"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-8"></a><span class="sd">     str: 01/01/YYYY</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-9"></a><span class="sd">    """</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-10"></a>    <span class="k">return</span> <span class="s2">"01/01/"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre>
<p>And now the function to actually call.</p>
<pre class="code ipython"><a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-1"></a><span class="k">def</span> <span class="nf">add_january_one</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-2"></a>    <span class="sd">"""adds /01/01/ to year-only dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-3"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-4"></a><span class="sd">    Args:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-5"></a><span class="sd">     source (pandas.Series): data with the dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-6"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-8"></a><span class="sd">     pandas.Series: years in source with /01/01/ added</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-9"></a><span class="sd">    """</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-10"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">add_month_date</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="two-digit-numbers">
<h4>6.1.5 Two-Digit Numbers</h4>
<p>This makes sure that there are exactly two digits in a number, adding a leading zero if needed.</p>
<pre class="code ipython"><a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-1"></a><span class="n">two_digit_expression</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">)</span> <span class="o">+</span> <span class="n">POSITIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-2"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-3"></a><span class="k">def</span> <span class="nf">two_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-4"></a>    <span class="sd">"""add a leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-5"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-6"></a><span class="sd">    Args:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-7"></a><span class="sd">     match (re.Match): match with one or two digits</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-8"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-10"></a><span class="sd">     str: the matched string with leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-11"></a><span class="sd">    """</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-12"></a>    <span class="c1"># for some reason the string-formatting raises an error if it's a string</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-13"></a>    <span class="c1"># so cast it to an int</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-14"></a>    <span class="k">return</span> <span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>
</pre>
<p>This is the function to call for the case where the number is followed by a slash (e.g. <tt class="docutils literal">2/</tt>).</p>
<pre class="code ipython"><a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-1"></a><span class="k">def</span> <span class="nf">clean_two_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-2"></a>    <span class="sd">"""makes sure source has two-digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-3"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-4"></a><span class="sd">    Args:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-5"></a><span class="sd">     source (pandas.Series): data with digit followed by slash</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-7"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-9"></a><span class="sd">     pandas.Series: source with digits coerced to two digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-10"></a><span class="sd">    """</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">two_digit_expression</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This is like <tt class="docutils literal">clean_two_digits</tt> but it doesn't check for the trailing slash. Use this if you have an isolated column of numbers that need to be two-digits.</p>
<pre class="code ipython"><a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-1"></a><span class="k">def</span> <span class="nf">clean_two_digits_isolated</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-2"></a>    <span class="sd">"""cleans two digits that are standalone</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-3"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-5"></a><span class="sd">     source (pandas.Series): source of the data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-7"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-9"></a><span class="sd">     pandas.Series: converted data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-10"></a><span class="sd">    """</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="cleaning-up-months">
<h4>6.1.6 Cleaning Up Months</h4>
<p>These clean up and convert written months (e.g. change <tt class="docutils literal">Aug</tt> to <tt class="docutils literal">08</tt>).</p>
<pre class="code ipython"><a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-1"></a><span class="n">digits</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-2"></a><span class="n">MONTH_TO_DIGITS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MONTH_PREFIXES</span><span class="p">,</span> <span class="n">digits</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-3"></a><span class="n">SHORT_MONTHS_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-4"></a><span class="k">def</span> <span class="nf">month_to_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-5"></a>    <span class="sd">"""converts short month to digits</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-6"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-7"></a><span class="sd">    Args:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-8"></a><span class="sd">     match (re.Match): object with short-month</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-9"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-10"></a><span class="sd">    Returns:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-11"></a><span class="sd">     str: month as two-digit number (e.g. Jan -&gt; 01)</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-12"></a><span class="sd">    """</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-13"></a>    <span class="k">return</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()]</span>
</pre>
<pre class="code ipython"><a name="rest_code_6073b8397d994280aad16a5dc7c7943e-1"></a><span class="k">def</span> <span class="nf">convert_short_month_to_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-2"></a>    <span class="sd">"""converts three-letter months to two-digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-3"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-5"></a><span class="sd">     source (pandas.Series): data with three-letter months</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-7"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-9"></a><span class="sd">     pandas.Series: source with short-months coverted to digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-10"></a><span class="sd">    """</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-12"></a>                 <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-13"></a>                 <span class="n">month_to_digits</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-14"></a>                 <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This function runs the previous three and is the main one that should be used. The others can be run individually for troubleshooting, though.</p>
<pre class="code ipython"><a name="rest_code_c7fb3254c651489e904705f74c039fe8-1"></a><span class="k">def</span> <span class="nf">clean_months</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-2"></a>    <span class="sd">"""clean up months (which start as words)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-3"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-5"></a><span class="sd">     source (pandas.Series): source of the months</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-6"></a><span class="sd">     sample (int): number of random samples to show</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-7"></a><span class="sd">    """</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-8"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-9"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-10"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting long months to short"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-11"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-12"></a>                    <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-13"></a>                    <span class="n">long_month_to_short</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-14"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting short months to digits"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-16"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-17"></a>                    <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-18"></a>                    <span class="n">month_to_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-19"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="frame-to-series">
<h4>6.1.7 Frame To Series</h4>
<p>This is for the case where the date-fields were broken up into columns in a data-frame.</p>
<pre class="code ipython"><a name="rest_code_37f92571504c45af80c86f9c60aff53e-1"></a><span class="k">def</span> <span class="nf">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">index_source</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-2"></a>    <span class="sd">"""re-combines data-frame into a series</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-3"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-5"></a><span class="sd">     frame (pandas.DataFrame): frame with month, day, year columns</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-6"></a><span class="sd">     index_source (pandas.series): source to copy index from</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-7"></a><span class="sd">     samples (index): number of random entries to print when done</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-8"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-10"></a><span class="sd">     pandas.Series: series with dates as month/day/year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-11"></a><span class="sd">    """</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-12"></a>    <span class="n">combined</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-13"></a>    <span class="n">combined</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_source</span><span class="o">.</span><span class="n">index</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-14"></a>    <span class="k">print</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-15"></a>    <span class="k">return</span> <span class="n">combined</span>
</pre>
</div>
</div>
<div class="section" id="year-only">
<h3>6.2 Year Only</h3>
<p>For the case where there is only a year, I'll add January 1 to the dates.</p>
<pre class="code ipython"><a name="rest_code_278f53251fdb4fc68b34e046c70b6a34-1"></a><span class="n">year_only_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">year_only</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
472  0        2010
495  0        1979
497  0        2008
481  0        1974
486  0        1973
Name: year_only, dtype: object

Random Sample After:
     match
495  0        01/01/1979
470  0        01/01/1983
462  0        01/01/1988
481  0        01/01/1974
480  0        01/01/2013
Name: year_only, dtype: object

Count of cleaned: 15
</pre>
</div>
<div class="section" id="leftovers">
<h3>6.3 Leftovers</h3>
<p>These were the odd cases that didn't seem to have a real pattern. Since I used a positive lookbehind to match everything but the year they only have the years in them, like the previous year-only cases.</p>
<pre class="code ipython"><a name="rest_code_a7b366fae7df44e6b69648ba1bfffdf2-1"></a><span class="n">leftovers_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
487  0        1992
477  0        1994
498  0        2005
488  0        1977
484  0        2004
Name: leftovers, dtype: object

Random Sample After:
     match
464  0        01/01/2016
455  0        01/01/1984
465  0        01/01/1976
475  0        01/01/2015
498  0        01/01/2005
Name: leftovers, dtype: object

Count of cleaned: 30
</pre>
<pre class="code ipython"><a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">year_only_cleaned</span><span class="p">,</span> <span class="n">leftovers_cleaned</span><span class="p">])</span>
<a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-2"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
45
</pre>
</div>
<div class="section" id="no-day-numeric">
<h3>6.4 No Day Numeric</h3>
<p>This is for the case where the date is formatted with slashes and there are no day-values. To make the months uniform I'm going to make them all two-digits first.</p>
<pre class="code ipython"><a name="rest_code_4b9fb0f5efe2443fa421f624443f9079-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">no_day_numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
450  0         1/1994
374  0        11/2000
403  0        10/1981
454  0         7/1982
358  0         1/1983
Name: no_day_numeric, dtype: object

Random Sample After:
     match
426  0        11/1984
415  0        02/1973
360  0        12/2008
367  0        09/2001
362  0        08/2003
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>Now I'll add the day.</p>
<pre class="code ipython"><a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-2"></a>                               <span class="n">SLASH</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-3"></a>                               <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
368  0        08/1986
409  0        10/1994
443  0        09/2000
404  0        10/1986
395  0        02/1977
Name: no_day_numeric, dtype: object

Random Sample After:
     match
349  0        05/01/1987
392  0        05/01/2000
448  0        05/01/2010
394  0        10/01/2001
424  0        04/01/1979
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>And add it to the total.</p>
<pre class="code ipython"><a name="rest_code_c186131450e34793996aefde3d7e33e5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_numeric_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
<pre class="code ipython"><a name="rest_code_3df8414b6ae0412494fc2d475c208687-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
157
</pre>
</div>
<div class="section" id="no-day">
<h3>6.5 No Day</h3>
<p>This is for cases like <em>Mar 2011</em> where no day was given. We're going to assume that it's the first day of the month for each case.</p>
<pre class="code ipython"><a name="rest_code_5ec35e8477ed4b75b14b1acea8d730f5-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">no_day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
     match
261  0           Oct 1986
269  0          July 1992
280  0          July 1985
295  0         March 1983
339  0        March, 2005
Name: no_day, dtype: object

Random Sample After:
     match
228  0        September 1985
304  0              Mar 2002
253  0              Feb 2016
276  0            April 1986
272  0              Feb 1993
Name: no_day, dtype: object

Count of cleaned: 115
Converting long months to short
Random Sample Before:
     match
315  0             Jun 1976
242  0             Nov 2010
237  0        February 1976
330  0           April 1988
311  0        February 1995
Name: no_day, dtype: object

Random Sample After:
     match
306  0        May 2004
254  0        Aug 1979
269  0        Jul 1992
337  0        Dec 2007
241  0        May 2004
Name: no_day, dtype: object

Count of cleaned: 115
Converting short months to digits
Random Sample Before:
     match
268  0        Dec 2009
298  0        Jan 1993
296  0        Aug 1979
270  0        May 2006
320  0        Nov 2012
Name: no_day, dtype: object

Random Sample After:
     match
246  0        07 1981
286  0        01 2013
263  0        09 1981
276  0        04 1986
247  0        05 1983
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we need to replace the spaces with the days.</p>
<pre class="code ipython"><a name="rest_code_e4c4257b864944be9a3724ac6b376a64-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-2"></a>                       <span class="n">SPACE</span> <span class="o">+</span> <span class="n">ONE_OR_MORE</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-3"></a>                       <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
251  0        12 1998
290  0        12 2011
281  0        08 2004
308  0        02 1994
294  0        02 1983
Name: no_day, dtype: object

Random Sample After:
     match
304  0        03/01/2002
332  0        06/01/1974
310  0        10/01/1992
293  0        09/01/2008
322  0        10/01/1991
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we can add it to the cleaned.</p>
<pre class="code ipython"><a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_cleaned</span><span class="p">])</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-3"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
272
</pre>
<p>Now to make sure we're where we expect we are.</p>
<pre class="code ipython"><a name="rest_code_4af27b29ecac455da3c4e0d31c8d711b-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
</div>
<div class="section" id="contraction">
<h3>6.6 Contraction</h3>
<p>There were no matches for the contraction so I'll ignore it for now.</p>
</div>
<div class="section" id="backwards">
<h3>6.7 Backwards</h3>
<p>This is the case where the day comes first. The first thing I'll do is split them up.</p>
<pre class="code ipython"><a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">backwards</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"day month year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-3"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  day month  year
0  24   Jan  2001
1  10   Sep  2004
2  26   May  1982
3  28  June  2002
4  06   May  1972
</pre>
<p>The next thing to do is to make sure the days all have two digits.</p>
<pre class="code ipython"><a name="rest_code_f6072f0515ec436a8714027b631047f4-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
31    26
39    21
4     06
57    13
36    19
Name: day, dtype: object

Random Sample After:
29    06
68    18
60    17
11    11
26    22
Name: day, dtype: object

Count of cleaned: 69
</pre>
<p>Next comes the months. This is basically the same problem as with the <em>no day</em> case so I'll re-use some of the code for that.</p>
<pre class="code ipython"><a name="rest_code_ab05fe73da44414cb294eb9f3502501c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Converting long months to short
Random Sample Before:
55    Dec
41    Nov
38    Jan
54    Dec
5     Oct
Name: month, dtype: object

Random Sample After:
30    Oct
55    Dec
15    Feb
38    Jan
14    Oct
Name: month, dtype: object

Count of cleaned: 69
Converting short months to digits
Random Sample Before:
29    Mar
22    May
45    Jan
47    Aug
61    Oct
Name: month, dtype: object

Random Sample After:
16    05
32    02
4     05
68    01
38    01
Name: month, dtype: object

Count of cleaned: 69
</pre>
<p>Now we need to combine them back together. In hindsight it might have been easier to convert everything into data frames instead of the other way around. Or maybe not. Since we want the indexes from the original data as our final answer I also have to copy the index from the original series</p>
<pre class="code ipython"><a name="rest_code_62fe0d46ed274e2db3053d05f493ef5e-1"></a><span class="n">backwards_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">backwards</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
177  0        01/18/1990
128  0        06/28/2002
181  0        08/18/1995
158  0        08/23/2000
185  0        08/17/1985
dtype: object
</pre>
<p>No it gets added to the combined series.</p>
<pre class="code ipython"><a name="rest_code_555c71acd16b47558ef5c9c343044db5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">backwards_cleaned</span><span class="p">])</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">backwards_count</span>
</pre>
<pre class="code ipython"><a name="rest_code_69e8faeacd0a4beaabb211af9573f40d-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
341
</pre>
</div>
<div class="section" id="words">
<h3>6.8 Words</h3>
<p>Since working with the data frame was easier than I though it would be I'll do that again.</p>
<pre class="code ipython"><a name="rest_code_7ba9ad608ca44fea9db0387aea288678-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_7ba9ad608ca44fea9db0387aea288678-2"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
      month  day  year
0     April  11,  1990
1       May  30,  2001
2       Feb  18,  1994
3  February  18,  1981
4  October.  11,  2013
</pre>
<p>First we'll clean out the months.</p>
<pre class="code ipython"><a name="rest_code_d0f876a0c5d545248054176fe3b11a12-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
25          Dec
10         Mar.
17        April
14    September
0         April
Name: month, dtype: object

Random Sample After:
5         Jan
12    October
24        May
2         Feb
28        May
Name: month, dtype: object

Count of cleaned: 34
Converting long months to short
Random Sample Before:
11       Jan
13    August
20       Sep
6       July
17     April
Name: month, dtype: object

Random Sample After:
27    Oct
30    Jul
6     Jul
14    Sep
33    Sep
Name: month, dtype: object

Count of cleaned: 34
Converting short months to digits
Random Sample Before:
24    May
31    Jun
5     Jan
7     Dec
32    Jan
Name: month, dtype: object

Random Sample After:
15    07
12    10
1     05
30    07
21    08
Name: month, dtype: object

Count of cleaned: 34
</pre>
<p>Now we'll clean up the punctuation for the days.</p>
<pre class="code ipython"><a name="rest_code_403a8eaa61c148c3b75b879c020e4983-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
22    11,
13     12
29     14
16    11,
24    14,
Name: day, dtype: object

Random Sample After:
2     18
1     30
24    14
15    25
17    17
Name: day, dtype: object

Count of cleaned: 34
</pre>
<p>So, what do we have so far?</p>
<pre class="code ipython"><a name="rest_code_fb060e1e44ad4b8aaa75fed980e99703-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day  year
0    04  11  1990
1    05  30  2001
2    02  18  1994
3    02  18  1981
4    10  11  2013
</pre>
<p>At this point we need to combine everything with a slash and restore the index.</p>
<pre class="code ipython"><a name="rest_code_fa253b729078464694a8162277a81f8f-1"></a><span class="n">words_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
194  0        04/11/1990
217  0        06/13/2011
209  0        07/25/1983
216  0        11/11/1988
223  0        10/14/1974
dtype: object
</pre>
<p>Now we'll add it to the total.</p>
<pre class="code ipython"><a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">words_cleaned</span><span class="p">])</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
375
</pre>
</div>
<div class="section" id="twentieth-century">
<h3>6.9 Twentieth Century</h3>
<p>We'll do the same trick with creating a dataframe. The first thing, though, is to replace the dashes with slashes.</p>
<pre class="code ipython"><a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-1"></a><span class="k">print</span><span class="p">(</span><span class="n">twentieth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-2"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">twentieth</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">DASH</span><span class="p">,</span> <span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-3"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
</pre>
<pre class="literal-block">
4-13-82
01/01/1991
</pre>
<p>Now, we'll create the frame.</p>
<pre class="code ipython"><a name="rest_code_4be7ee2936874cd4b245d919e12856ce-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">twentieth_cleaned</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">])</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1     6  18   85
2     7   8   71
3     9  27   75
4     2   6   96
</pre>
<div class="section" id="months">
<h4>6.9.1 Months</h4>
<p>The months need to be converted to two-digits.</p>
<pre class="code ipython"><a name="rest_code_4dc97efa0ae94a2d8a2474ed70e57c53-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
73     4
53    10
84     8
93     6
80    10
Name: month, dtype: object

Random Sample After:
76    03
33    07
32    01
94    07
67    05
Name: month, dtype: object

Count of cleaned: 100
</pre>
<p>As do the days.</p>
<pre class="code ipython"><a name="rest_code_5389733c16244c0b97ca473d67c73a35-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
78    14
29    15
37    15
75    18
80    05
Name: day, dtype: object

Random Sample After:
35    14
30    14
17    21
88    16
0     25
Name: day, dtype: object

Count of cleaned: 100
</pre>
<pre class="code ipython"><a name="rest_code_a3e1f85c163e4d8da80c2fb1af92bb61-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1    06  18   85
2    07  08   71
3    09  27   75
4    02  06   96
</pre>
<p>Now we have to add <tt class="docutils literal">19</tt> to each of the years.</p>
<pre class="code ipython"><a name="rest_code_4ac655e89dc64840aa093c1acfbc915c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">TWO_DIGITS</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"19"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre>
<pre class="literal-block">
Random Sample Before:
41    75
90    97
97    90
69    97
65    81
Name: year, dtype: object

Random Sample After:
4     1996
44    1971
11    1975
17    1998
61    1979
Name: year, dtype: object

Count of cleaned: 100
</pre>
<p>Now we have to join them back up.</p>
<pre class="code ipython"><a name="rest_code_8baf04995baa452ba852a7b93dc2fb0a-1"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">twentieth</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
67  0        07/06/1991
88  0        12/08/1982
4   0        02/06/1996
40  0        07/29/1975
72  0        07/11/1977
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_1d503b332f6e4822a51f526d131a35c7-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_1d503b332f6e4822a51f526d131a35c7-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">twentieth_cleaned</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_59162f44789846f0a3a07c733a932da6-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">twentieth_count</span>
</pre>
</div>
</div>
<div class="section" id="numeric">
<h3>6.10 Numeric</h3>
<p>The final category is dates with the format <tt class="docutils literal">mm/dd/yyyy</tt>.</p>
<pre class="code ipython"><a name="rest_code_2f9ce5575b0f482bb132ce984d804e2b-1"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0         5/24/1990
15  0         1/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
Name: numeric, dtype: object
</pre>
<p>We should check and make sure there are no dashes here.</p>
<pre class="code ipython"><a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-1"></a><span class="n">has_dashes</span> <span class="o">=</span> <span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-2"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="p">[</span><span class="n">has_dashes</span><span class="p">])</span>
</pre>
<pre class="literal-block">
Series([], Name: numeric, dtype: object)
</pre>
<p>It looks like it doesn't so we'll skip this check.</p>
<pre class="code ipython"><a name="rest_code_c49525c65d3c47f086c390e1a05429ea-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day  year
0     5  24  1990
1     1  25  2011
2    10  13  1976
3    07  25  1984
4    03  31  1985
</pre>
<pre class="code ipython"><a name="rest_code_a007c13ce32a4311ae0b9a94b7f6e539-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
5      5
18    04
4     03
0      5
10    12
Name: month, dtype: object

Random Sample After:
0     05
24    04
3     07
11    08
13    11
Name: month, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_71afd6cc3e404c2fba4a7edccec5e061-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
9     11
19    08
8     15
13     3
24    27
Name: day, dtype: object

Random Sample After:
23    20
22    11
7     13
18    08
0     24
Name: day, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_c6874e85b6eb4167992d86cda4fd4879-1"></a><span class="n">numeric_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
94  0        12/08/1990
92  0        04/08/2004
43  0        04/13/2002
38  0        07/27/1986
14  0        05/24/1990
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_3389eacbbc4045a8b83c74e93f999331-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">numeric_count</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
500
</pre>
<p>At this point it looks like we've cleaned all the cases.</p>
</div>
<div class="section" id="re-combining-the-cleaned">
<h3>6.11 Re-combining The Cleaned</h3>
<p>Because these notebooks can execute things out of order I'm going to create one monolithic concatenation and ignore the one that I was using to keep the running total.</p>
<pre class="code ipython"><a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-2"></a>                         <span class="n">twentieth_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-3"></a>                         <span class="n">words_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-4"></a>                         <span class="n">backwards_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-5"></a>                         <span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-6"></a>                         <span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-7"></a>                         <span class="n">year_only_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-8"></a>                         <span class="n">leftovers_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-9"></a><span class="p">])</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-10"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-11"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-12"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<pre class="literal-block">
500
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
</pre>
</div>
</div>
<div class="section" id="convert-to-datetimes">
<h2>7 Convert to Datetimes</h2>
<pre class="code ipython"><a name="rest_code_957b32bad7d440c5b5dd381de14cd546-1"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-2"></a><span class="n">datetimes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/</span><span class="si">%d</span><span class="s2">/%Y"</span><span class="p">)</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-3"></a><span class="k">print</span><span class="p">(</span><span class="n">datetimes</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
    match
14  0       1990-05-24
15  0       2011-01-25
17  0       1976-10-13
24  0       1984-07-25
30  0       1985-03-31
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-1"></a><span class="n">sorted_dates</span> <span class="o">=</span> <span class="n">datetimes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-2"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
9   0       1971-04-10
84  0       1971-05-18
2   0       1971-07-08
53  0       1971-07-11
28  0       1971-09-12
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_3176215c31b3415397607142ecb2f364-1"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre>
<pre class="literal-block">
     match
231  0       2016-05-01
141  0       2016-05-30
186  0       2016-10-13
161  0       2016-10-19
413  0       2016-11-01
dtype: datetime64[ns]
</pre>
<p>The grader wants a Series with the indices of the original data put in the order of the sorted dates.</p>
<pre class="code ipython"><a name="rest_code_8b1ec468304743d9af86de787065a82d-1"></a><span class="n">answer</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_8b1ec468304743d9af86de787065a82d-2"></a><span class="k">print</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
0     9
1    84
2     2
3    53
4    28
dtype: int16
</pre>
</div>
<div class="section" id="the-date-sorter-function">
<h2>8 The date_sorter Function</h2>
<p>This is the function called by the grader. Since the work was done outside of it we just need to make sure that it returns our answer.</p>
<pre class="code ipython"><a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-1"></a><span class="k">def</span> <span class="nf">date_sorter</span><span class="p">():</span>
<a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-2"></a>    <span class="k">return</span> <span class="n">answer</span>
</pre>
<p><strong>note:</strong> This produced a 94% score, so there are still some cases not correctly handled.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/evaluating-a-model/" class="u-url">Evaluating a Model</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/evaluating-a-model/" rel="bookmark"><time class="published dt-published" datetime="2017-06-12T15:05:00-07:00" title="2017-06-12 15:05">2017-06-12 15:05</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In this assignment you will train several models and evaluate how effectively they predict instances of credit-card fraud using data based on <a class="reference external" href="https://www.kaggle.com/dalpozz/creditcardfraud">this dataset from Kaggle</a>. This is their description:</p>
<pre class="literal-block">
The datasets contains transactions made by credit cards in September 2013 by european cardholders. This dataset presents transactions that occurred in two days, where we have 492 frauds out of 284,807 transactions. The dataset is highly unbalanced, the positive class (frauds) account for 0.172% of all transactions.

It contains only numerical input variables which are the result of a PCA transformation. Unfortunately, due to confidentiality issues, we cannot provide the original features and more background information about the data. Features V1, V2, ... V28 are the principal components obtained with PCA, the only features which have not been transformed with PCA are 'Time' and 'Amount'. Feature 'Time' contains the seconds elapsed between each transaction and the first transaction in the dataset. The feature 'Amount' is the transaction Amount, this feature can be used for example-dependant cost-senstive learning. Feature 'Class' is the response variable and it takes value 1 in case of fraud and 0 otherwise.

Given the class imbalance ratio, we recommend measuring the accuracy using the Area Under the Precision-Recall Curve (AUPRC). Confusion matrix accuracy is not meaningful for unbalanced classification.

The dataset has been collected and analysed during a research collaboration of Worldline and the Machine Learning Group (`http://mlg.ulb.ac.be &lt;http://mlg.ulb.ac.be&gt;`_) of ULB (Université Libre de Bruxelles) on big data mining and fraud detection. More details on current and past projects on related topics are available on `http://mlg.ulb.ac.be/BruFence &lt;http://mlg.ulb.ac.be/BruFence&gt;`_ and `http://mlg.ulb.ac.be/ARTML &lt;http://mlg.ulb.ac.be/ARTML&gt;`_

Please cite: Andrea Dal Pozzolo, Olivier Caelen, Reid A. Johnson and Gianluca Bontempi. Calibrating Probability with Undersampling for Unbalanced Classification. In Symposium on Computational Intelligence and Data Mining (CIDM), IEEE, 2015
</pre>
<p>Each row in `fraud_data.csv` corresponds to a credit card transaction. Features include confidential variables `V1` through `V28` as well as `Amount` which is the amount of the transaction.</p>
<p>The target is stored in the `class` column, where a value of 1 corresponds to an instance of fraud and 0 corresponds to an instance of not fraud.</p>
<div class="section" id="imports">
<h2>1 Imports</h2>
<pre class="code ipython"><a name="rest_code_ae453741ead748348fe8c7ae489664bd-1"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-4"></a><span class="kn">import</span> <span class="nn">seaborn</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-5"></a>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-6"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-7"></a>    <span class="n">GridSearchCV</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-8"></a>    <span class="n">train_test_split</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-9"></a>    <span class="p">)</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-10"></a><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-11"></a><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-12"></a><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-13"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-14"></a>    <span class="n">auc</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-15"></a>    <span class="n">confusion_matrix</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-16"></a>    <span class="n">precision_recall_curve</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-17"></a>    <span class="n">precision_score</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-18"></a>    <span class="n">recall_score</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-19"></a>    <span class="n">roc_curve</span><span class="p">,</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-20"></a>    <span class="p">)</span>
<a name="rest_code_ae453741ead748348fe8c7ae489664bd-21"></a><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre>
<pre class="code ipython"><a name="rest_code_4cbdbd5243fd4ac48840c699e50aec4b-1"></a><span class="n">DATA</span> <span class="o">=</span> <span class="s2">"data/fraud_data.csv"</span>
</pre>
</div>
<div class="section" id="setup-the-plotting">
<h2>2 Setup the plotting</h2>
<pre class="code ipython"><a name="rest_code_923d535399ca4bf3a143c481505eb86b-1"></a><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">magic</span><span class="p">(</span><span class="s1">'matplotlib inline'</span><span class="p">)</span>
<a name="rest_code_923d535399ca4bf3a143c481505eb86b-2"></a><span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<a name="rest_code_923d535399ca4bf3a143c481505eb86b-3"></a><span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_923d535399ca4bf3a143c481505eb86b-4"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="exploring-the-data">
<h2>3 Exploring the data</h2>
<div class="section" id="how-much-fraud-is-there">
<h3>3.1 How much fraud is there?</h3>
<p>Import the data from `fraud_data.csv`. What percentage of the observations in the dataset are instances of fraud?</p>
<pre class="code ipython"><a name="rest_code_c8b77711bc1642d88cafb754b79cddb4-1"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_667973d723344822bb5c573d38cefb7a-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Fraction of cases that were fraud: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
</pre>
<pre class="literal-block">
Fraction of cases that were fraud: 0.02
</pre>
<pre class="code ipython"><a name="rest_code_e5e48572c4604ae7a9904dc13c5ccc06-1"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Class"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre>
<img alt="fraud.png" src="posts/evaluating-a-model/fraud.png"><p>So it appears that most of the cases aren't fraudulent.</p>
</div>
</div>
<div class="section" id="setting-up-the-training-and-testing-sets">
<h2>4 Setting up the training and testing sets</h2>
<p>As always, we split the data into training and testing sets so there's no `data leakage`.</p>
<pre class="code ipython"><a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-1"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
<a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-2"></a>
<a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-3"></a><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-4"></a><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-5"></a>
<a name="rest_code_cdc8fe8b0e6e455dbd8b317a67924715-6"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="scores">
<h2>5 Scores</h2>
<p>This is a convenience class to store the scores for the models.</p>
<pre class="code ipython"><a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-1"></a><span class="k">class</span> <span class="nc">ScoreKeeper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-2"></a>    <span class="sd">"""only holds scores, doesn't create them"""</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-7"></a>        <span class="k">return</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-8"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-9"></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-10"></a>        <span class="sd">"""calculates the difference between the three scores</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-11"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-12"></a><span class="sd">        Args:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-13"></a><span class="sd">         other (Scores): the right-hand side of the subtraction</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-14"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-15"></a><span class="sd">        Returns:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-16"></a><span class="sd">         ScoreKeeper: object with the differences</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-17"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-18"></a><span class="sd">        Raises:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-19"></a><span class="sd">         TypeError: one of the values wasn't set on one of the Scores</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-20"></a><span class="sd">        """</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-21"></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">ScoreKeeper</span><span class="p">()</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-22"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">accuracy</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-23"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">precision</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-24"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">recall</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-25"></a>        <span class="k">return</span> <span class="n">scores</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-26"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-27"></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-28"></a>        <span class="sd">"""compares scores</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-29"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-30"></a><span class="sd">        Args:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-31"></a><span class="sd">         other (Scores): object to compare to</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-32"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-33"></a><span class="sd">        Returns:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-34"></a><span class="sd">         bool: True if all three scores are greater than other's</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-35"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-36"></a><span class="sd">        Raises:</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-37"></a><span class="sd">         TypeError: one of the values wasn't set</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-38"></a><span class="sd">        """</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-39"></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-40"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-41"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">recall</span><span class="p">))</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-42"></a>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-43"></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-44"></a>        <span class="k">return</span> <span class="s2">"Precision: {0:.2f}, Accuracy: {1:.2f}, Recall: {2:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span>
<a name="rest_code_b2582b1eb2ea4c628801c3a970b660b2-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_278351c6da4b49aabea572b774f1dbdb-1"></a><span class="k">class</span> <span class="nc">Scores</span><span class="p">(</span><span class="n">ScoreKeeper</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-2"></a>    <span class="sd">"""holds scores"""</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-4"></a>        <span class="sd">"""fits and scores the model</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-5"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-6"></a><span class="sd">        Args:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-7"></a><span class="sd">         model: model that has been fit to the data</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-8"></a><span class="sd">         x_test: input for accuracy measurement</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-9"></a><span class="sd">         y_test: labels for scoring the model</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-10"></a><span class="sd">        """</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scores</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-19"></a>        <span class="k">return</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-20"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-21"></a>    <span class="nd">@property</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-22"></a>    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-23"></a>        <span class="sd">"""the model's predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-24"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-25"></a><span class="sd">        Returns:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-26"></a><span class="sd">         array: predictions for x-test</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-27"></a><span class="sd">        """</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-28"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-30"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-31"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-32"></a>    <span class="nd">@property</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-33"></a>    <span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-34"></a>        <span class="sd">"""the accuracy of the model's predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-35"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-36"></a><span class="sd">        the fraction that was correctly predicted</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-37"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-38"></a><span class="sd">        (tp + tn)/(tp + tn + fp + fn)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-39"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-40"></a><span class="sd">        Returns:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-41"></a><span class="sd">         float: accuracy of predictions for x-test</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-42"></a><span class="sd">        """</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-43"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-45"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-46"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-47"></a>    <span class="nd">@property</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-48"></a>    <span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-49"></a>        <span class="sd">"""the recall score for the predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-50"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-51"></a><span class="sd">        The fraction of true-positives penalized for missing any</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-52"></a><span class="sd">        This is the better metric when missing a case is more costly</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-53"></a><span class="sd">        than accidentally identifying a case.</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-54"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-55"></a><span class="sd">        tp / (tp + fn)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-56"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-57"></a><span class="sd">        Returns:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-58"></a><span class="sd">         float: recall of the predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-59"></a><span class="sd">        """</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-60"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-62"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-63"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-64"></a>    <span class="nd">@property</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-65"></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-66"></a>        <span class="sd">"""the precision of the test predictions</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-67"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-68"></a><span class="sd">        The fraction of true-positives penalized for false-positives</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-69"></a><span class="sd">        This is the better metric when accidentally identifying a case</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-70"></a><span class="sd">        is more costly than missing a case</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-71"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-72"></a><span class="sd">        tp / (tp + fp)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-73"></a>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-74"></a><span class="sd">        Returns:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-75"></a><span class="sd">         float: precision score</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-76"></a><span class="sd">        """</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-77"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
<a name="rest_code_278351c6da4b49aabea572b774f1dbdb-79"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span>
</pre>
</div>
<div class="section" id="a-dummy-classifier-baseline">
<h2>6 A Dummy Classifier (baseline)</h2>
<p>Using `X_train`, `X_test`, `y_train`, and `y_test` (as defined above), we're going to train a <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html">dummy classifier</a> that classifies everything as the majority class of the training data, so we will have a baseline to compare with the other models.</p>
<p>First we create and train it</p>
<pre class="code ipython"><a name="rest_code_3b575270d44547579e2cf81b4cba8ff5-1"></a><span class="n">strategy</span> <span class="o">=</span> <span class="s2">"most_frequent"</span>
<a name="rest_code_3b575270d44547579e2cf81b4cba8ff5-2"></a><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">)</span>
<a name="rest_code_3b575270d44547579e2cf81b4cba8ff5-3"></a><span class="n">dummy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_3b575270d44547579e2cf81b4cba8ff5-4"></a><span class="n">dummy_scores</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<p>Now we make our predctions and score them</p>
<pre class="code ipython"><a name="rest_code_70a7f538e880419ca3a1af33beb5d846-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Dummy Classifier: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dummy_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Dummy Classifier: Precision: 0.00, Accuracy: 0.99, Recall: 0.00
</pre>
<p>Since the model is always predicting that the data-points are not fraudulent (the majority case), it never returns any true positives and since both precision and recall have true positive as their numerators, they are both 0.</p>
<p>For the accuracy we can look at the count of each class:</p>
<pre class="code ipython"><a name="rest_code_20be1a68471a44e29a38f8543e0f494c-1"></a><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre>
<pre class="literal-block">
0    5344
1      80
Name: Class, dtype: int64
</pre>
<p>And since we know it will always predict 0, we can double-check it (the true and false positives are both 0).</p>
<pre class="code ipython"><a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-1"></a><span class="n">true_positive</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-2"></a><span class="n">true_negative</span> <span class="o">=</span> <span class="mi">5344</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-3"></a><span class="n">false_positive</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-4"></a><span class="n">false_negative</span> <span class="o">=</span> <span class="mi">80</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-5"></a><span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">true_negative</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">true_negative</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-6"></a>                                            <span class="o">+</span> <span class="n">false_positive</span> <span class="o">+</span> <span class="n">false_negative</span><span class="p">)</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-7"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Accuracy: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
<a name="rest_code_5dd35a8fd7cd4388bf6b904d66227425-8"></a><span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">dummy_scores</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Accuracy: 0.99
</pre>
</div>
<div class="section" id="svc-accuracy-recall-and-precision">
<h2>7 SVC Accuracy, Recall and Precision</h2>
<p>Now we're going to create a <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html">Support Vector Classifier</a> that uses the sklearn default valuse.</p>
<pre class="code ipython"><a name="rest_code_142b58de4d81413e8a8c16124c508fe2-1"></a><span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<a name="rest_code_142b58de4d81413e8a8c16124c508fe2-2"></a><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_142b58de4d81413e8a8c16124c508fe2-3"></a><span class="n">svc_scores</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_4e5b0b9c26f049e69bc016220375f325-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
SVC: Precision: 1.00, Accuracy: 0.99, Recall: 0.38
</pre>
<p>We can now compare it to the Dummy Classifier to see how it did against the baseline.</p>
<pre class="code ipython"><a name="rest_code_ad9f3d8960b14f2797019f2496ce87d9-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC - Dummy: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores</span> <span class="o">-</span> <span class="n">dummy_scores</span><span class="p">))</span>
<a name="rest_code_ad9f3d8960b14f2797019f2496ce87d9-2"></a><span class="k">assert</span> <span class="n">svc_scores</span> <span class="o">&gt;</span> <span class="n">dummy_scores</span>
</pre>
<pre class="literal-block">
SVC - Dummy: Precision: 1.00, Accuracy: 0.01, Recall: 0.38
</pre>
<p>The SVC was much better on precision and recall (as expected) and slightly better on accuracy.</p>
</div>
<div class="section" id="confusion-matrix">
<h2>8 Confusion Matrix</h2>
<p>We're going to create a Support Vector Classifier with ``C=1e9`` and ``gamma=1e-07`` (the ``e`` is the equivalent of ``**``). Then, using the <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC.decision_function">decision function</a> and a threshold of -220, we're going to make our predictions and create a confusion matrix. The decision-function calculates the distance of each data point from the label, so the further a value is from 0, the further it is from the separating hyper-plane.</p>
<pre class="code ipython"><a name="rest_code_596bb487f24d4d108af9966f98482ed0-1"></a><span class="n">error_penalty</span> <span class="o">=</span> <span class="mf">1e9</span>
<a name="rest_code_596bb487f24d4d108af9966f98482ed0-2"></a><span class="n">kernel_coefficient</span> <span class="o">=</span> <span class="mf">1e-07</span>
<a name="rest_code_596bb487f24d4d108af9966f98482ed0-3"></a><span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">220</span>
</pre>
<pre class="code ipython"><a name="rest_code_5a291358f696416bace7394800e82e3c-1"></a><span class="n">svc_2</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">error_penalty</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">kernel_coefficient</span><span class="p">)</span>
<a name="rest_code_5a291358f696416bace7394800e82e3c-2"></a><span class="n">svc_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_5a291358f696416bace7394800e82e3c-3"></a><span class="n">svc_scores_2</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">svc_2</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<p>The decision_function gives us the distances which we then need to convert to labels. In this case we're going to label anything greater than -220 as a 1 and anything less as a 0.</p>
<pre class="code ipython"><a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-1"></a><span class="n">decisions</span> <span class="o">=</span> <span class="n">svc_2</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-2"></a><span class="n">decisions</span><span class="p">[</span><span class="n">decisions</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-3"></a><span class="n">decisions</span><span class="p">[</span><span class="n">decisions</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-4"></a><span class="n">matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">decisions</span><span class="p">)</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-5"></a><span class="n">matrix</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"Actual Positive"</span><span class="p">,</span> <span class="s2">"Actual Negative"</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Predicted Positive"</span><span class="p">,</span> <span class="s2">"Predicted Negative"</span><span class="p">])</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-6"></a><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
<a name="rest_code_32fed51d6e154e0198857ed1769a7b7c-7"></a>               <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
</pre>
<table border="1" class="docutils">
<colgroup>
<col width="30%">
<col width="35%">
<col width="35%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head"></th>
<th class="head">Predicted Positive</th>
<th class="head">Predicted Negative</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>Actual Positive</td>
<td>5320</td>
<td>24</td>
</tr>
<tr>
<td>Actual Negative</td>
<td>14</td>
<td>66</td>
</tr>
</tbody>
</table>
<pre class="code ipython"><a name="rest_code_af4b8b17231e4ab693c7d62716cabb5d-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC 2: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores_2</span><span class="p">))</span>
<a name="rest_code_af4b8b17231e4ab693c7d62716cabb5d-2"></a><span class="k">assert</span> <span class="n">svc_scores_2</span> <span class="o">&gt;</span> <span class="n">dummy_scores</span>
</pre>
<pre class="literal-block">
SVC 2: Precision: 0.94, Accuracy: 1.00, Recall: 0.80
</pre>
<pre class="code ipython"><a name="rest_code_6a0497c9d49c4cd1a586dae040115da0-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC 2 - SVC Default: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores_2</span> <span class="o">-</span> <span class="n">svc_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
SVC 2 - SVC Default: Precision: -0.06, Accuracy: 0.01, Recall: 0.43
</pre>
<p>This model did slightly worse with precision that the default, slightly better for accuracy but quite a bit better for recall. So if we didn't care as much about false positives it would be the better model.</p>
</div>
<div class="section" id="logistic-regression">
<h2>9 Logistic Regression</h2>
<p>This model will be a Logistic Regression model built with the default parameters.</p>
<p>For the logisitic regression classifier, we'll create a precision recall curve and a roc curve using y_test and the probability estimates for X_test (probability it is fraud).</p>
<p>Looking at the precision recall curve, what is the recall when the precision is `0.75`?
Looking at the roc curve, what is the true positive rate when the false positive rate is `0.16`?</p>
<pre class="code ipython"><a name="rest_code_f801614bd33c427691c0c03bf04dfa85-1"></a><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-2"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-3"></a><span class="n">y_scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-4"></a><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-5"></a><span class="n">closest_zero</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-6"></a><span class="n">closest_zero_precision</span> <span class="o">=</span> <span class="n">precision</span><span class="p">[</span><span class="n">closest_zero</span><span class="p">]</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-7"></a><span class="n">closest_zero_recall</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">closest_zero</span><span class="p">]</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-8"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precision</span><span class="o">==</span><span class="mf">0.75</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-9"></a><span class="n">recall_at_precision</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-10"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-11"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-12"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Precision-Recall Curve"</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-13"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">closest_zero_precision</span><span class="p">,</span> <span class="n">closest_zero_recall</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-14"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Precision"</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-15"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Recall"</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-16"></a><span class="n">axe</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">recall_at_precision</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"r"</span><span class="p">)</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-17"></a><span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a name="rest_code_f801614bd33c427691c0c03bf04dfa85-18"></a><span class="n">title</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Precision vs Recall"</span><span class="p">)</span>
</pre>
<img alt="logistic_regression_precision_recall.png" src="posts/evaluating-a-model/logistic_regression_precision_recall.png"><pre class="code ipython"><a name="rest_code_b7f4a56dea16471783166e82c8daa117-1"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precision</span><span class="o">==</span><span class="mf">0.75</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_b7f4a56dea16471783166e82c8daa117-2"></a><span class="n">recall_at_precision</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a name="rest_code_b7f4a56dea16471783166e82c8daa117-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Recall at precision 0.75: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_at_precision</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Recall at precision 0.75: 0.825
</pre>
<p>When the precision is 0.75, the recall is 0.825.</p>
<pre class="code ipython"><a name="rest_code_72de484d2dde42788d12e89099251d21-1"></a><span class="n">y_score_lr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-2"></a><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_score_lr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-3"></a><span class="n">area_under_the_curve</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-4"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mf">0.16</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-5"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-6"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-7"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"ROC Curve (area={0:.2f})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area_under_the_curve</span><span class="p">))</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-8"></a><span class="n">axe</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">true_positive_rate</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-9"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"False Positive Rate"</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-10"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"True Positive Rate"</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-11"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"ROC Curve"</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-12"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-13"></a><span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a name="rest_code_72de484d2dde42788d12e89099251d21-14"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>
</pre>
<img alt="lr_roc.png" src="posts/evaluating-a-model/lr_roc.png"><pre class="code ipython"><a name="rest_code_14a0aeb6692a4cb784358c2cfdbe79fc-1"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mf">0.16</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_14a0aeb6692a4cb784358c2cfdbe79fc-2"></a><span class="k">print</span><span class="p">(</span><span class="s2">"True positive rate where false positive rate is 0.16: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">true_positive_rate</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</pre>
<pre class="literal-block">
True positive rate where false positive rate is 0.16: 0.9375
</pre>
<dl class="docutils">
<dt>def true_positive_where_false(model, threshold):</dt>
<dd>"""get the true-positive value matching the threshold for false-positive</dd>
<dt>Args:</dt>
<dd>model: the model fit to the data with predict_proba method</dd>
<dt>Return:</dt>
<dd>float: True Positive rate</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 466)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>"""
y_score_lr = model.predict_proba(X_test)
false_positive_rate, true_positive_rate, _ = roc_curve(y_test, y_score_lr[:, 1])
index = numpy.where(numpy.round(false_positive_rate, 2)==0.16)[0][0]
return true_positive_rate[index]</p>
<dl class="docutils">
<dt>def recall_where_precision(model, threshold):</dt>
<dd>"""return recall where the first precision matches threshold</dd>
<dt>Args:</dt>
<dd>model: model fit to the data with decision_function
threshold (float): point to find matching recall</dd>
<dt>Returns:</dt>
<dd>float: recall matching precision threshold</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 482)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>"""
y_scores = model.decision_function(X_test)
precision, recall, thresholds = precision_recall_curve(y_test, y_scores)
return recall[numpy.where(precision==threshold)[0][0]]</p>
<dl class="docutils">
<dt>def answer_five():</dt>
<dd>model = LogisticRegression()
model.fit(X_train, y_train)
recall_score = recall_where_precision(model, 0.75)
true_positive = true_positive_where_false(model, threshold=0.16)
return (recall_score, true_positive)</dd>
</dl>
<p>answer_five()</p>
<p>parameters = dict(penalty=["l1", "l2"], C=[10**power for power in range(-2, 3)])
model = LogisticRegression()</p>
<p>grid = GridSearchCV(model, parameters, scoring="recall")
grid.fit(X_train, y_train)</p>
<p>grid.cv_results_</p>
<p>len(grid.cv_results_["mean_test_score"])</p>
<p>grid.cv_results_
l1 = [grid.cv_results_["mean_test_score"][index] for index in range(0, len(grid.cv_results_['mean_test_score']), 2)]
l2 = [grid.cv_results_["mean_test_score"][index] for index in range(1, len(grid.cv_results_["mean_test_score"])+ 1, 2)]
l1</p>
<p>l2</p>
<dl class="docutils">
<dt>def answer_six():</dt>
<dd>parameters = dict(penalty=["l1", "l2"], C=[10**power for power in range(-2, 3)])
model = LogisticRegression()
grid = GridSearchCV(model, parameters, scoring="recall")
grid.fit(X_train, y_train)
l1 = [grid.cv_results_["mean_test_score"][index] for index in range(0, len(grid.cv_results_['mean_test_score']), 2)]
l2 = [grid.cv_results_["mean_test_score"][index] for index in range(1, len(grid.cv_results_["mean_test_score"])+ 1, 2)]
return numpy.array([l1, l2]).T</dd>
</dl>
<p>answer_six()</p>
<dl class="docutils">
<dt>def GridSearch_Heatmap(scores):</dt>
<dd>get_ipython().magic('matplotlib inline')
import seaborn as sns
import matplotlib.pyplot as plt
plt.figure()
scores = answer_six()
sns.heatmap(scores, xticklabels=['l1','l2'], yticklabels=[0.01, 0.1, 1, 10, 100])
plt.yticks(rotation=0);</dd>
<dt>if VERBOSE:</dt>
<dd>GridSearch_Heatmap(answer_six())</dd>
</dl>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/predicting-cancer/" class="u-url">Predicting Cancer (Course 3, Assignment 1)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/predicting-cancer/" rel="bookmark"><time class="published dt-published" datetime="2017-06-03T16:32:14-07:00" title="2017-06-03 16:32">2017-06-03 16:32</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This assignment uses the Breast Cancer Wisconsin (Diagnostic) Database to create a classifier that can help diagnose patients.</p>
<div class="section" id="imports">
<h2>Imports</h2>
<pre class="code python"><a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-1"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-3"></a><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>
</pre>
</div>
<div class="section" id="the-data">
<h2>The data</h2>
<pre class="code python"><a name="rest_code_09e399a144b64db98e1a439b6cdd935b-1"></a><span class="n">cancer</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
</pre>
<p>This data set has 569 rows (cases) with 30 numeric features. The outcomes are either 1 - <em>malignant</em>, or 0 - <em>benign</em>.</p>
<p>From their description:</p>
<pre class="literal-block">
Features are computed from a digitized image of a fine needle aspirate (FNA) of a breast mass.  They describe characteristics of the cell nuclei present in the image.
</pre>
<p>The object returned by <tt class="docutils literal">load_breast_cancer()</tt> is a scikit-learn Bunch object, which is similar to a dictionary, but like pandas, also supports using dot-notation to retrieve attributes when possible (i.e. no spaces in the keys).</p>
<pre class="code python"><a name="rest_code_168a4d0357164c04a2d0edc233e7da3f-1"></a><span class="k">print</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre>
<pre class="literal-block">
dict_keys(['DESCR', 'target', 'feature_names', 'data', 'target_names'])
</pre>
</div>
<div class="section" id="question-0-example">
<h2>Question 0 (Example)</h2>
<p>How many features does the breast cancer dataset have?</p>
<pre class="code python"><a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-1"></a><span class="k">def</span> <span class="nf">answer_zero</span><span class="p">():</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-2"></a>    <span class="sd">"""number of feature names in the data</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-3"></a>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-5"></a><span class="sd">     int: count of feature names in the 'cancer' data-set</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-6"></a><span class="sd">    """</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-7"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">cancer</span><span class="p">[</span><span class="s1">'feature_names'</span><span class="p">])</span>
</pre>
<pre class="code python"><a name="rest_code_3a103505aa0e49d397f21a59cf3900fa-1"></a><span class="n">answer_zero</span><span class="p">()</span>
</pre>
<pre class="literal-block">
30
</pre>
</div>
<div class="section" id="question-1">
<h2>Question 1</h2>
<p>Scikit-learn works with lists, numpy arrays, scipy-sparse matrices, and pandas DataFrames, so converting the dataset to a DataFrame is not necessary for training this model. Using a DataFrame does however help make many things easier such as munging data, so let's practice creating a classifier with a pandas DataFrame.</p>
<pre class="code python"><a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-1"></a><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-2"></a>    <span class="sd">"""converts the sklearn 'cancer' bunch</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-3"></a>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-5"></a><span class="sd">     pandas.DataFrame: cancer data</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-6"></a><span class="sd">    """</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-7"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-8"></a>    <span class="n">columns</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span> <span class="p">[</span><span class="s2">"target"</span><span class="p">])</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-9"></a>    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_1a98be338b894117849c588e30875b68-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_1a98be338b894117849c588e30875b68-2"></a><span class="k">assert</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="mi">31</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="question-2">
<h2>Question 2</h2>
<p>What is the class distribution? (i.e. how many instances of <tt class="docutils literal">malignant</tt> and how many <tt class="docutils literal">benign</tt>?)</p>
<pre class="code python"><a name="rest_code_42f1476214a8419cac3ecd027425862b-1"></a><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-2"></a>    <span class="sd">"""calculates number of malignent and benign</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-3"></a>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-5"></a><span class="sd">     pandas.Series: counts of each</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-6"></a><span class="sd">    """</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-8"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-9"></a>    <span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s2">"malignant benign"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-10"></a>    <span class="k">return</span> <span class="n">counts</span>
</pre>
<pre class="code python"><a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-1"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_two</span><span class="p">()</span>
<a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-2"></a><span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">malignant</span> <span class="o">==</span> <span class="mi">212</span>
<a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-3"></a><span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">benign</span> <span class="o">==</span> <span class="mi">357</span>
</pre>
</div>
<div class="section" id="question-3">
<h2>Question 3</h2>
<p>Split the DataFrame into `X` (the data) and `y` (the labels).</p>
<pre class="code python"><a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-1"></a><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-2"></a>    <span class="sd">"""splits the data into data and labels</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-3"></a>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-5"></a><span class="sd">     (pandas.DataFrame, pandas.Series): data, labels</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-6"></a><span class="sd">    """</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-8"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="p">[</span><span class="n">cancerdf</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-9"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">target</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-10"></a>    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</pre>
<pre class="code python"><a name="rest_code_9919328ff14647d6aef49f90f0829545-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">answer_three</span><span class="p">()</span>
<a name="rest_code_9919328ff14647d6aef49f90f0829545-2"></a><span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">569</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_9919328ff14647d6aef49f90f0829545-3"></a><span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">569</span><span class="p">,)</span>
</pre>
</div>
<div class="section" id="question-4">
<h2>Question 4</h2>
<p>Using <tt class="docutils literal">train_test_split()</tt>, split <tt class="docutils literal">X</tt> and <tt class="docutils literal">y</tt> into training and test sets <tt class="docutils literal">(X_train, X_test, y_train, and y_test)</tt>.</p>
<pre class="code python"><a name="rest_code_0c59601156ea4c649b68814e95988aa6-1"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-2"></a>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-3"></a><span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-4"></a>    <span class="sd">"""splits data into training and testing sets</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-5"></a>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-7"></a><span class="sd">     tuple(pandas.DataFrame): x_train, y_train, x_test, y_test</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-8"></a><span class="sd">    """</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-9"></a>    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">answer_three</span><span class="p">()</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-10"></a>    <span class="k">return</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">426</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">143</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-1"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-2"></a><span class="k">assert</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">426</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-3"></a><span class="k">assert</span> <span class="n">x_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-4"></a><span class="k">assert</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">426</span><span class="p">,)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-5"></a><span class="k">assert</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,)</span>
</pre>
</div>
<div class="section" id="question-5">
<h2>Question 5</h2>
<p>Using KNeighborsClassifier, fit a k-nearest neighbors (knn) classifier with <tt class="docutils literal">X_train</tt>, <tt class="docutils literal">y_train</tt> and using one nearest neighbor (<tt class="docutils literal">n_neighbors = 1</tt>).</p>
<pre class="code python"><a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-1"></a><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-2"></a>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-3"></a><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-4"></a>    <span class="sd">"""Fits a KNN-1 model to the data</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-5"></a>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-7"></a><span class="sd">     sklearn.neighbors.KNeighborsClassifier: trained data</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-8"></a><span class="sd">    """</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-9"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-10"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-11"></a>    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-12"></a>    <span class="k">return</span> <span class="n">model</span>
</pre>
<pre class="code python"><a name="rest_code_5ce594db5f63485e969f541f23bc2615-1"></a><span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_5ce594db5f63485e969f541f23bc2615-2"></a><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">knn</span><span class="p">)</span> <span class="o">==</span> <span class="n">KNeighborsClassifier</span>
<a name="rest_code_5ce594db5f63485e969f541f23bc2615-3"></a><span class="k">assert</span> <span class="n">knn</span><span class="o">.</span><span class="n">n_neighbors</span> <span class="o">==</span> <span class="mi">1</span>
</pre>
</div>
<div class="section" id="question-6">
<h2>Question 6</h2>
<p>Using your knn classifier, predict the class label using the mean value for each feature.</p>
<p>You can use <tt class="docutils literal"><span class="pre">cancerdf.mean()[:-1].values.reshape(1,</span> <span class="pre">-1)</span></tt> which gets the mean value for each feature, ignores the target column, and reshapes the data from 1 dimension to 2 (necessary for the predict method of KNeighborsClassifier).</p>
<pre class="code python"><a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-1"></a><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-2"></a>    <span class="sd">"""Predicts the class labels for the means of all features</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-3"></a>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-5"></a><span class="sd">     numpy.array: prediction (0 or 1)</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-6"></a><span class="sd">    """</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-8"></a>    <span class="n">means</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">mean</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-9"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-10"></a>    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_b97acb920cb04b71814ef44e235e35b4-1"></a><span class="n">answer_six</span><span class="p">()</span>
</pre>
<pre class="literal-block">
array([ 1.])
</pre>
</div>
<div class="section" id="question-7">
<h2>Question 7</h2>
<p>Using your knn classifier, predict the class labels for the test set <tt class="docutils literal">X_test</tt>.</p>
<pre class="code python"><a name="rest_code_730d1f64e89a4f1689ac989e708b421c-1"></a><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-2"></a>    <span class="sd">"""predicts likelihood of cancer for test set</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-3"></a>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-5"></a><span class="sd">     numpy.array: vector of predictions</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-6"></a><span class="sd">    """</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-7"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-8"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-9"></a>    <span class="k">return</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-1"></a><span class="n">predictions</span> <span class="o">=</span> <span class="n">answer_seven</span><span class="p">()</span>
<a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-2"></a><span class="k">assert</span> <span class="n">predictions</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,)</span>
<a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-3"></a><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">}</span>
</pre>
<pre class="code python"><a name="rest_code_8bcb0654ef15444a835dfc5bca610e33-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"no cancer: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span><span class="o">==</span><span class="mi">0</span><span class="p">])))</span>
<a name="rest_code_8bcb0654ef15444a835dfc5bca610e33-2"></a><span class="k">print</span><span class="p">(</span><span class="s2">"cancer: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span><span class="o">==</span><span class="mi">1</span><span class="p">])))</span>
</pre>
</div>
<div class="section" id="question-8">
<h2>Question 8</h2>
<p>Find the score (mean accuracy) of your knn classifier using <tt class="docutils literal">X_test</tt> and <tt class="docutils literal">y_test</tt>.</p>
<pre class="code python"><a name="rest_code_714ff61fb3d84b01949cd891539b61b0-1"></a><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-2"></a>    <span class="sd">"""calculates the mean accuracy of the KNN model</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-3"></a>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-5"></a><span class="sd">     float: mean accuracy of the model predicting cancer</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-6"></a><span class="sd">    """</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-7"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-8"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-9"></a>    <span class="k">return</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_2e49b8f6f8ba4835af17d93952a09bc9-1"></a><span class="n">answer_eight</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="optional-plot">
<h2>Optional plot</h2>
<p>Try using the plotting function below to visualize the differet predicition scores between training and test sets, as well as malignant and benign cells.</p>
<pre class="code python"><a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-2"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-3"></a><span class="k">def</span> <span class="nf">accuracy_plot</span><span class="p">():</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-4"></a>    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-5"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-6"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-7"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-8"></a>    <span class="c1"># Find the training and testing accuracies by target value (i.e. malignant, benign)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-9"></a>    <span class="n">mal_train_X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-10"></a>    <span class="n">mal_train_y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-11"></a>    <span class="n">ben_train_X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-12"></a>    <span class="n">ben_train_y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-13"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-14"></a>    <span class="n">mal_test_X</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-15"></a>    <span class="n">mal_test_y</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-16"></a>    <span class="n">ben_test_X</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-17"></a>    <span class="n">ben_test_y</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-18"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-19"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-20"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-21"></a>    <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">mal_train_X</span><span class="p">,</span> <span class="n">mal_train_y</span><span class="p">),</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ben_train_X</span><span class="p">,</span> <span class="n">ben_train_y</span><span class="p">),</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-22"></a>              <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">mal_test_X</span><span class="p">,</span> <span class="n">mal_test_y</span><span class="p">),</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ben_test_X</span><span class="p">,</span> <span class="n">ben_test_y</span><span class="p">)]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-23"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-24"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-25"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-26"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-27"></a>    <span class="c1"># Plot the scores as a bar chart</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-28"></a>    <span class="n">bars</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">'#4c72b0'</span><span class="p">,</span><span class="s1">'#4c72b0'</span><span class="p">,</span><span class="s1">'#55a868'</span><span class="p">,</span><span class="s1">'#55a868'</span><span class="p">])</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-29"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-30"></a>    <span class="c1"># directly label the score onto the bars</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-31"></a>    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-32"></a>        <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-33"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">*.</span><span class="mi">90</span><span class="p">,</span> <span class="s1">'{0:.{1}f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-34"></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-35"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-36"></a>    <span class="c1"># remove all the ticks (both axes), and tick labels on the Y axis</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-37"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="s1">'on'</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-38"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-39"></a>    <span class="c1"># remove the frame of the chart</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-40"></a>    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-41"></a>        <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-42"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-43"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Malignant</span><span class="se">\n</span><span class="s1">Training'</span><span class="p">,</span> <span class="s1">'Benign</span><span class="se">\n</span><span class="s1">Training'</span><span class="p">,</span> <span class="s1">'Malignant</span><span class="se">\n</span><span class="s1">Test'</span><span class="p">,</span> <span class="s1">'Benign</span><span class="se">\n</span><span class="s1">Test'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-44"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Training and Test Accuracies for Malignant and Benign Cells'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-45"></a><span class="n">accuracy_plot</span><span class="p">()</span>
</pre>
<img alt="accuracies.png" src="posts/predicting-cancer/accuracies.png">
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/bokeh-test/" class="u-url">Bokeh Test</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/bokeh-test/" rel="bookmark"><time class="published dt-published" datetime="2017-05-24T12:29:09-07:00" title="2017-05-24 12:29">2017-05-24 12:29</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="the-plot">
<h2>The Plot</h2>
<script src="posts/bokeh-test/portland_unemployment.js" id="686c5dd6-168a-4f7d-acbc-524875d93b59" data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9" data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"></script>
</div>
<div class="section" id="what-this-is">
<h2>What This Is</h2>
<p>This is a re-do of the final plot done for data-science with python course 2 week 4. The original was done with matplotlib and this was done with bokeh to get some interaction working. When I tried to create it the first time bokeh raised some errors saying that <tt class="docutils literal">height</tt> had been defined more than once. I don't know what really caused it - possibly a namespace clash where I was re-using something I didn't intend to re-use - but when I created a new notebook that only created the one plot it worked. Since this uses javascript I used Jupyter and the web-inteface to test it out (emacs ipython doesn't seem to be able to render javascript (unless I'm doing it wrong)).</p>
</div>
<div class="section" id="how-it-got-exported">
<h2>How It Got Exported</h2>
<p>I won't go over the creating of the data (since I just copied it from an earlier notebook) but this is how the bokeh plot was created.</p>
<div class="section" id="imports">
<h3>Imports</h3>
<p>These were the bokeh parts I needed.</p>
<pre class="code python"><a name="rest_code_6fdd1928445f47c2aee381e930466867-1"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-2"></a>    <span class="n">BoxAnnotation</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-3"></a>    <span class="n">CustomJS</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-4"></a>    <span class="n">Span</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-5"></a>    <span class="n">Toggle</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-6"></a><span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-7"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-8"></a><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-9"></a>    <span class="n">output_file</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-10"></a>    <span class="n">output_notebook</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-11"></a>    <span class="n">show</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-12"></a><span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-13"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-14"></a><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-15"></a>    <span class="n">figure</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-16"></a>    <span class="n">ColumnDataSource</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-17"></a> <span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-18"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-19"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-20"></a>    <span class="n">CrosshairTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-21"></a>    <span class="n">HoverTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-22"></a>    <span class="n">PanTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-23"></a>    <span class="n">ResetTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-24"></a>    <span class="n">ResizeTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-25"></a>    <span class="n">SaveTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-26"></a>    <span class="n">UndoTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-27"></a>    <span class="n">WheelZoomTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-28"></a>    <span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-29"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-30"></a><span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">column</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-31"></a><span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">CDN</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-32"></a><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">autoload_static</span>
</pre>
</div>
<div class="section" id="some-constants">
<h3>Some Constants</h3>
<pre class="code python"><a name="rest_code_006662e13b804d2a9a33b79c74db13f0-1"></a><span class="n">NATIONAL_COLOR</span> <span class="o">=</span> <span class="s2">"slategrey"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-2"></a><span class="n">NATIONAL_LABEL</span> <span class="o">=</span> <span class="s2">"National"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-3"></a><span class="n">PORTLAND_COLOR</span> <span class="o">=</span> <span class="s2">"cornflowerblue"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-4"></a><span class="n">PORTLAND_LABEL</span> <span class="o">=</span> <span class="s2">"Portland-Hillsboro-Vancouver"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-5"></a><span class="n">S_AND_P_COLOR</span> <span class="o">=</span> <span class="s2">"#90151B"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-6"></a><span class="n">S_AND_P_LABEL</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Index"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-7"></a><span class="n">HOUSING_COLOR</span> <span class="o">=</span> <span class="s2">"#D89159"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-8"></a><span class="n">HOUSING_LABEL</span> <span class="o">=</span> <span class="s2">"House Price Index"</span>
</pre>
</div>
<div class="section" id="the-data">
<h3>The Data</h3>
<p><tt class="docutils literal">bokeh</tt> doesn't work with <tt class="docutils literal">pandas</tt> <tt class="docutils literal">DataFrame</tt>'s (or at least I couldn't get it to work). Instead you create a DataFrame-like object using the <tt class="docutils literal">ColumnDataSource</tt>.</p>
<pre class="code python"><a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-1"></a><span class="n">portland_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-2"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-3"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-4"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-5"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-6"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-7"></a><span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-8"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-9"></a><span class="n">national_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-10"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-11"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-12"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-13"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-14"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-15"></a>    <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-16"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-17"></a><span class="n">housing_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-18"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-19"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-20"></a>        <span class="n">price</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-21"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-22"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-23"></a>    <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-24"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-25"></a><span class="n">s_and_p_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-26"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-27"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-28"></a>        <span class="n">value</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">VALUE</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-29"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-30"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-31"></a><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-tools">
<h3>The Tools</h3>
<p>These are the things that add interactivity to the plot. You have to create new ones for each figure so I made a function to get them.</p>
<pre class="code python"><a name="rest_code_dea109b0974f472da1ee62dacab2c118-1"></a><span class="k">def</span> <span class="nf">make_tools</span><span class="p">():</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-2"></a>    <span class="sd">"""makes the tools for the figures</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-3"></a>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-5"></a><span class="sd">     list: tool objects</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-6"></a><span class="sd">    """</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-7"></a>    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-8"></a>    <span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-9"></a>    <span class="p">(</span><span class="s2">"unemployment"</span><span class="p">,</span> <span class="s2">"@unemployment"</span><span class="p">),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-10"></a>    <span class="p">])</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-11"></a>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-12"></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-13"></a>        <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-14"></a>        <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-15"></a>        <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-16"></a>        <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-17"></a>        <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-18"></a>        <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-19"></a>        <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-20"></a>        <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-21"></a>    <span class="p">]</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-22"></a>    <span class="k">return</span> <span class="n">tools</span>
</pre>
<p>The <tt class="docutils literal">HoverTool tooltips</tt> argument is a list of tuples - one tuple for each dimension of the data. The first argument of the tuple (e.g. "month") is the label that will appear when the user hover's over the data point, while the second (e.g. "@month_label") tells bokeh which column to use for the data (so it has to match the key you used in the <tt class="docutils literal">ColumnDataSource</tt> creation).</p>
</div>
<div class="section" id="helper-functions">
<h3>Helper Functions</h3>
<p>The sub-figures needed some common elements so I created functions for them.</p>
<div class="section" id="scaling-the-timestamps">
<h4>Scaling The Timestamps</h4>
<p>The timestamps by default are unreadable (because there are so many). This re-scales them so they are more readable.</p>
<pre class="code python"><a name="rest_code_10864e10bcd84d67978a9addead9edc8-1"></a><span class="k">def</span> <span class="nf">scale_timestamp</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-2"></a>    <span class="sd">"""gets the scaled timestamp for element location</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-3"></a>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-5"></a><span class="sd">     index: index in the portland.datetime series</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-7"></a><span class="sd">     epoch timestamp used to locate place in plot</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-8"></a><span class="sd">    """</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-9"></a>    <span class="k">return</span> <span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="n">TIME_SCALE</span>
</pre>
</div>
<div class="section" id="drawing-the-recession">
<h4>Drawing the Recession</h4>
<p>The recession is indicated as a blue box on each plot.</p>
<pre class="code python"><a name="rest_code_dda80a34e41641f3aa46953e365f4eba-1"></a><span class="k">def</span> <span class="nf">make_recession</span><span class="p">():</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-2"></a>    <span class="sd">"""Makes the box for the recession</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-3"></a>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-5"></a><span class="sd">     BoxAnnotation to color the recession</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-6"></a><span class="sd">    """</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-7"></a>    <span class="k">return</span> <span class="n">BoxAnnotation</span><span class="p">(</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-8"></a>        <span class="n">left</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_start</span><span class="p">),</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-9"></a>        <span class="n">right</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_end</span><span class="p">),</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-10"></a>        <span class="n">fill_color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-11"></a>        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="vertical-lines">
<h4>Vertical Lines</h4>
<p>Things like the unemployment lows and highs are indicated by a vertical line.</p>
<pre class="code python"><a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-1"></a><span class="k">def</span> <span class="nf">make_vertical</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">):</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-2"></a>    <span class="sd">"""makes a vertical line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-3"></a>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-4"></a><span class="sd">    Args:</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-5"></a><span class="sd">     location: place on the x-axis for the line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-6"></a><span class="sd">     color (str): line-color for the line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-8"></a><span class="sd">     Span at index</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-9"></a><span class="sd">    """</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-10"></a>    <span class="k">return</span> <span class="n">Span</span><span class="p">(</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-12"></a>        <span class="n">line_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-13"></a>        <span class="n">dimension</span><span class="o">=</span><span class="s2">"height"</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-14"></a>    <span class="p">)</span>
</pre>
</div>
<div class="section" id="make-verticals">
<h4>Make Verticals</h4>
<p>Since there's more than one line, this function adds all the lines.</p>
<pre class="code python"><a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-1"></a><span class="k">def</span> <span class="nf">make_verticals</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-2"></a>    <span class="sd">"""makes the verticals and adds them to the figures"""</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-3"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-4"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">unemployment_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-5"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-6"></a>    <span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-7"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-8"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">s_and_p_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-9"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-10"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">housing_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-12"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"limegreen"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-13"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-14"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">national_peak</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-15"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-16"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="the-figures">
<h3>The Figures</h3>
<p>This plot has three sub-figures, each of which is created separately then added to the <tt class="docutils literal">Column</tt>.</p>
<div class="section" id="unemployment">
<h4>Unemployment</h4>
<pre class="code python"><a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-1"></a><span class="n">tools</span> <span class="o">=</span> <span class="n">make_tools</span><span class="p">()</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-2"></a><span class="n">unemployment_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-3"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-4"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-5"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-6"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-7"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Unemployment (2007-2017)"</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-8"></a><span class="p">)</span>
</pre>
<p>Next the lines for the time-series data are added.</p>
<pre class="code python"><a name="rest_code_daa52556f183451c9f5cbdb9c218494d-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-2"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-3"></a>    <span class="n">source</span><span class="o">=</span><span class="n">portland_source</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-4"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">PORTLAND_COLOR</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-5"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">PORTLAND_LABEL</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-6"></a>          <span class="p">)</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-7"></a>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-8"></a><span class="n">line</span> <span class="o">=</span> <span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-9"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-10"></a>    <span class="n">source</span><span class="o">=</span><span class="n">national_source</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-11"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">NATIONAL_COLOR</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-12"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">NATIONAL_LABEL</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-13"></a><span class="p">)</span>
</pre>
<p>Now the recession-box and high and low points for each plot is added.</p>
<pre class="code python"><a name="rest_code_3911a35ae6af46b3ae37a99f8d6263d4-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_3911a35ae6af46b3ae37a99f8d6263d4-2"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">)</span>
</pre>
<p>Now some labels are added and the grid is turned off.</p>
<pre class="code python"><a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"% Unemployment"</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-2"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-3"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-4"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
</pre>
</div>
<div class="section" id="s-p-500">
<h4>S &amp; P 500</h4>
<p>The S &amp; P 500 had didn't have unemployment as the dependent variable so I made a different set of tools to change the label for the hover.</p>
<pre class="code python"><a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-3"></a>    <span class="p">(</span><span class="s2">"Value"</span><span class="p">,</span> <span class="s2">"@value"</span><span class="p">),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-4"></a><span class="p">])</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-14"></a><span class="p">]</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-15"></a><span class="n">s_and_p_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"S &amp; P 500 Index"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-22"></a><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-24"></a>                    <span class="n">source</span><span class="o">=</span><span class="n">s_and_p_source</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-25"></a>                    <span class="n">line_color</span><span class="o">=</span><span class="n">S_AND_P_COLOR</span><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-26"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">s_and_p_figure</span><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-28"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Valuation"</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-29"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-30"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-31"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-32"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
<div class="section" id="housing">
<h4>Housing</h4>
<pre class="code python"><a name="rest_code_e8c2026d5451488292ad21b127b65a8b-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-3"></a>    <span class="p">(</span><span class="s2">"Price"</span><span class="p">,</span> <span class="s2">"@price"</span><span class="p">),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-4"></a><span class="p">])</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-14"></a><span class="p">]</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-15"></a><span class="n">housing_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"House Price Index"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-22"></a><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">housing_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-24"></a>                           <span class="n">source</span><span class="o">=</span><span class="n">housing_source</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-25"></a>                           <span class="n">line_color</span><span class="o">=</span><span class="n">HOUSING_COLOR</span><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-26"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">housing_figure</span><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-28"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Sale Price ($1,000)"</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-29"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-30"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-31"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-32"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
</div>
<div class="section" id="combining">
<h3>Combining</h3>
<p>Once the figures were created I combined them into a <tt class="docutils literal">column</tt>, since I wanted them stacked verticallly.</p>
<pre class="code python"><a name="rest_code_7f9a96af6524449babcfe03399e43b8d-1"></a><span class="n">combined</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">,</span> <span class="n">s_and_p_figure</span><span class="p">,</span> <span class="n">housing_figure</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="outputting-the-code">
<h3>Outputting The Code</h3>
<p>In order to be able to embed the code, you need to have bokeh export it. There are multiple ways to do this, but I chose the <tt class="docutils literal">autoload_static</tt> method.</p>
<pre class="code python"><a name="rest_code_7915c39cbee2401f8cf94bf97e6a06a3-1"></a><span class="n">OUTPUT_JAVASCRIPT</span> <span class="o">=</span> <span class="s2">"portland_unemployment.js"</span>
<a name="rest_code_7915c39cbee2401f8cf94bf97e6a06a3-2"></a><span class="n">js</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">autoload_static</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">CDN</span><span class="p">,</span> <span class="n">OUTPUT_JAVASCRIPT</span><span class="p">)</span>
</pre>
<p>The third argument (<tt class="docutils literal">OUTPUT_JAVASCRIPT</tt>) is the path you want to refer to in the tag. The returned <tt class="docutils literal">js</tt> variable contains the javascript you need to save (using the filename you gave <tt class="docutils literal">autoload_static</tt>) and the <tt class="docutils literal">tag</tt> contains the HTML tag that you embed to let the server know you want to use the javascript that was saved.</p>
<p>Since both values are just strings, and nothing was saved to disk, I saved it for later.</p>
<pre class="code python"><a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUTPUT_JAVASCRIPT</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-2"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-3"></a>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"portland_tag.html"</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-5"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="getting-it-into-nikola">
<h3>Getting It Into Nikola</h3>
<p>The first thing was to create this file using <tt class="docutils literal">nikola new_post</tt> (it's called bokeh-test.rst). Next I created a directory in the <tt class="docutils literal">files</tt> folder that had the same name as this file (without the ".rst" extension) to put the javascript in so nikola would find it when I built the HTML.</p>
<pre class="code bash"><a name="rest_code_3612d3ea9550434c9b0bdc024a3b44c0-1"></a>mkdir files/posts/bokeh-test
</pre>
<p>Once I copied the <tt class="docutils literal">portland_unemployment.js</tt> file to the <tt class="docutils literal"><span class="pre">bokeh-test</span></tt> directory I opened the <tt class="docutils literal">portland_tag.html</tt> file and embedded it directly into the post sing the <tt class="docutils literal">raw</tt> restructureText directive.</p>
<pre class="code rst"><a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-1"></a><span class="p">..</span> <span class="ow">raw</span><span class="p">::</span> html
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-2"></a>
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-3"></a>   &lt;script
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-4"></a>       src="portland_unemployment.js"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-5"></a>       id="686c5dd6-168a-4f7d-acbc-524875d93b59"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-6"></a>       data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-7"></a>       data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-8"></a>   &gt;&lt;/script&gt;
</pre>
</div>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
